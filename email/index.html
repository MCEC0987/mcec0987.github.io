<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>临时邮箱 - TempMail</title>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <style>
    /* ==================== 邮件内容区域 ==================== */
    .email-content {
        /* 保留文本中的空白和换行，让长文本自动换行，适合显示邮件正文 */
        white-space: pre-wrap;   /* 保留空格和换行，同时允许自动换行 */
        word-wrap: break-word;   /* 当单词太长时，允许在单词内换行，防止内容溢出 */
        font-family: monospace;  /* 使用等宽字体，让代码或邮件内容更清晰对齐 */
        background: #f5f5f5;     /* 浅灰色背景，柔和不刺眼 */
        padding: 15px;           /* 内边距，让文字和边框之间留出空间 */
        border-radius: 5px;      /* 圆角边框，看起来更友好 */
        margin-top: 10px;        /* 顶部外边距，与上方元素保持距离 */
    }

    /* ==================== 邮件主题 ==================== */
    .email-subject {
        font-weight: bold;       /* 加粗字体，突出主题 */
        color: #1976d2;          /* 蓝色文字，常见于链接或重要标题 */
    }

    /* ==================== 未读邮件标记 ==================== */
    .unread {
        font-weight: bold;       /* 加粗，引起注意 */
        color: #d32f2f;          /* 红色文字，表示未读状态 */
    }

    /* ==================== 鼠标变为手型 ==================== */
    .cursor-pointer {
        cursor: pointer;         /* 鼠标悬停时显示为手指形状，表示可点击 */
    }

    /* ==================== 邮件列表项悬停效果 ==================== */
    .email-list-item:hover {
        background-color: #f5f5f5; /* 鼠标悬停时背景变浅灰，增强交互反馈 */
    }

    /* ==================== 已读邮件标签样式 (Vuetify 的 chip 组件) ==================== */
    .v-chip--read {
        background-color: #e0e0e0 !important; /* 灰色背景，表示已读 */
        color: #757575 !important;             /* 深灰色文字，降低视觉权重 */
        /* !important 强制应用，覆盖其他可能冲突的样式 */
    }

    /* ==================== 未读邮件标签样式 ==================== */
    .v-chip--unread {
        background-color: #ffebee !important; /* 淡红色背景，提示未读 */
        color: #d32f2f !important;             /* 红色文字，与未读标记一致 */
    }

    /* ==================== 发件人头像 ==================== */
    .sender-avatar {
        width: 40px;               /* 固定宽度 */
        height: 40px;              /* 固定高度，与宽度相同形成正方形 */
        border-radius: 50%;        /* 圆形裁剪，变成头像样式 */
        background: var(--v-primary-base); /* 使用CSS变量，--v-primary-base通常是主题主色，由外部定义 */
        color: white;              /* 文字颜色白色，与背景形成对比 */
        display: flex;             /* 弹性盒布局，方便内部文字居中 */
        align-items: center;       /* 垂直居中 */
        justify-content: center;   /* 水平居中 */
        font-weight: bold;         /* 文字加粗，比如显示名字首字母 */
        margin-right: 15px;        /* 右侧外边距，与相邻内容分开 */
    }

    /* ==================== 邮件预览文本 ==================== */
    .email-preview {
        color: #666;               /* 深灰色文字，比正文稍淡，表示次要内容 */
        font-size: 0.9em;          /* 字体略小，相对父元素字体大小 */
        margin-top: 5px;           /* 顶部留一点空间 */
        overflow: hidden;          /* 超出容器的内容隐藏 */
        text-overflow: ellipsis;   /* 用省略号(...)表示被截断的文本 */
        white-space: nowrap;       /* 强制文本不换行，形成单行预览 */
    }

    /* ==================== 附件标签 ==================== */
    .attachment-chip {
        margin-right: 5px;         /* 右侧外边距，让多个标签之间有空隙 */
        margin-bottom: 5px;        /* 底部外边距，如果换行也有间距 */
    }

    /* ==================== 邮件详情头部 ==================== */
    .email-detail-header {
        background: #f5f5f5;       /* 浅灰背景，与正文区域呼应 */
        padding: 15px;             /* 内边距 */
        border-radius: 5px;        /* 圆角 */
        margin-bottom: 20px;       /* 底部外边距，与下方内容隔开 */
    }

    /* ==================== 邮件标签容器 ==================== */
    .email-tags {
        margin-top: 10px;          /* 顶部留空，与上方内容分开 */
    }

    /* ==================== 邮件操作栏 ==================== */
    .email-actions {
        background: white;         /* 白色背景，突出操作按钮 */
        padding: 10px 16px;        /* 上下10px，左右16px内边距 */
        border-bottom: 1px solid #e0e0e0; /* 底部浅灰色边框，分隔内容 */
        position: sticky;          /* 粘性定位，滚动时固定在顶部 */
        top: 0;                    /* 距离顶部0，即贴在顶端 */
        z-index: 5;                /* 层级较高，避免被其他元素覆盖 */
    }

    /* ==================== 统计卡片 ==================== */
    .stats-card {
        transition: all 0.3s ease; /* 所有属性变化时添加0.3秒的缓动过渡，使效果平滑 */
    }
    .stats-card:hover {
        transform: translateY(-2px);           /* 鼠标悬停时向上移动2px，产生浮起效果 */
        box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important; /* 增强阴影，突出悬浮感 */
    }

    /* ==================== 密码强度条容器 ==================== */
    .password-strength-meter {
        height: 8px;               /* 高度只有8px，细条状 (默认4px) */
        border-radius: 2px;        /* 圆角，让条两端圆润 */
        margin-top: 4px;           /* 顶部留一点空间 */
    }

    /* 以下五个类分别表示密码强度从弱到强的进度条颜色和宽度 */
    .password-strength-0 {
        background: #f44336;       /* 红色，表示强度0（最弱） */
        width: 20%;                /* 只占20%宽度 */
    }
    .password-strength-1 {
        background: #ff9800;       /* 橙色 */
        width: 40%;                /* 占40% */
    }
    .password-strength-2 {
        background: #ffc107;       /* 黄色 */
        width: 60%;
    }
    .password-strength-3 {
        background: #4caf50;       /* 绿色 */
        width: 80%;
    }
    .password-strength-4 {
        background: #2196f3;       /* 蓝色 */
        width: 100%;               /* 满宽，表示强度最高 */
    }

    /* ==================== 邮箱账户信息卡片 ==================== */
    .email-account-info {
        padding: 16px;                                         /* 内边距 */
        background: linear-gradient(135deg, var(--v-primary-base) 0%, var(--v-secondary-base) 100%); /* 渐变背景，从主色到次色，135度方向 */
        color: white;                                          /* 文字白色 */
        border-radius: 8px;                                    /* 圆角8px */
        margin-bottom: 16px;                                   /* 底部外边距 */
    }

    /* ==================== 响应式设计：针对中等屏幕（宽度 ≤ 960px）的调整 ==================== */
    @media (max-width: 960px) {
        .email-actions {
            flex-wrap: wrap;      /* 允许子元素换行，避免挤在一行 */
            gap: 8px;             /* 子元素之间的间隙 */
        }
        .email-actions .v-btn {
            margin: 2px;          /* 按钮四周小边距 */
            flex: 1;              /* 每个按钮平均分配剩余宽度 */
            min-width: 45%;       /* 最小宽度为父容器的45%，这样一行最多放两个按钮 */
        }
        .v-bottom-navigation .v-btn {
            min-width: auto;      /* 重置最小宽度，让按钮自适应 */
            padding: 0 8px;       /* 左右内边距减小，适应小屏 */
        }
    }

    /* ==================== 响应式设计：针对小屏幕（宽度 ≤ 600px）的进一步调整 ==================== */
    @media (max-width: 600px) {
        .email-actions .v-btn {
            min-width: 100%;      /* 按钮占据整行宽度，方便点击 */
            margin: 4px 0;        /* 上下外边距分开按钮 */
        }
        .v-toolbar__title {
            font-size: 1rem;      /* 工具栏标题字体大小调整为1rem（通常为16px） */
        }
        .sender-avatar {
            width: 32px;          /* 头像缩小一些，节省空间 */
            height: 32px;         /* 同步缩小高度 */
            font-size: 0.9em;     /* 内部文字稍小 */
        }
    }
</style>
<style type="text/css">
/* ==================== 侧边栏顶部图片 ==================== */

/* 图片容器的样式 */
.sidebar-logo-container {
    width: 100%;                /* 宽度占满整个父容器 */
    padding: 0px 0px 0px 0px; /* 内边距：上20px 右16px 下8px 左16px */
    text-align: center;         /* 让容器内的内容居中对齐 */
    background: transparent;     /* 背景设为透明 */
    box-sizing: border-box;      /* 让padding不会影响容器的实际总宽度 */
}

/* 图片本身的样式 */
.sidebar-logo {
    max-width: 100%;            /* 图片最大宽度不超过父容器 */
    height: auto;               /* 高度自动调整，保持图片原有比例 */
    display: block;             /* 把图片变成块级元素 */
    margin: 0 auto;             /* 左右自动外边距，实现居中效果 */
    border-radius: 0px;         /* 添加8px的圆角边框，让图片四角变圆 */
    object-fit: contain;        /* 图片在容器内完整显示，保持比例 */
    transition: transform 0.3s ease; /* 添加过渡动画效果，transform属性变化时会缓慢变化0.3秒 */
}

/* 鼠标悬停在图片上时的效果 */
.sidebar-logo:hover {
    transform: scale(1.02);     /* 放大到原来的1.02倍，有轻微的放大效果 */
}

/* 深色模式适配 */
/* 当父元素有 theme--dark 类时，图片的样式 */
.theme--dark .sidebar-logo {
    filter: brightness(0.9);    /* 降低图片亮度到90%，让图片在深色模式下看起来更柔和 */
}

/* 小屏幕适配 */
/* 当屏幕宽度小于等于600px时，应用以下样式（通常是手机屏幕） */
@media (max-width: 600px) {
    .sidebar-logo-container {
        padding: 0px 0px 0px 0px; /* 减小内边距，节省屏幕空间 12px 12px 4px 12px */
    }
}
</style>
</head>
<body>
<link rel="stylesheet" type="text/css" href="1/style.css">
<script src="1/script.js"></script>
<!-- <script src="1/script1.js"></script> --> <!-- AI 做的，可以删掉 -->
    <div id="progress-container">
        <div id="progress-bar"></div>
        <div id="progress-percent">0%</div>
    </div>
    
    
    <div id="app">
        <v-app :dark="settings.darkMode">
            <!-- 侧边栏 -->
            <v-navigation-drawer
                v-model="drawer"
                app
                temporary
                width="300"
            >
            <!-- 侧边栏顶部自适应图片 -->
<div class="sidebar-logo-container">
    <img src="sidebar.gif" 
         alt="Logo" 
         class="sidebar-logo">
</div>
<!-- 线条 -->
<div style="height: 8px; 
            background: linear-gradient(90deg, var(--v-primary-base) 0%, rgba(2,255,255,0.8) 0%, /* 50% */ var(--v-primary-base) 100%); 
            margin: 0.5px 0px; /* 12px 12px */
            border-radius: 2px;
            opacity: 0.7;">
</div>
                <v-list dense nav>
                    <v-list-item>
                        <v-list-item-content>
                            <v-list-item-title class="title">
                                <v-icon left>mdi-email-fast-outline</v-icon>
                                临时邮箱
                            </v-list-item-title>
                            <v-list-item-subtitle v-if="currentEmail" class="mt-1">
                                <v-chip small color="white" text-color="primary" class="mt-1">
                                    {{ currentEmail }}
                                </v-chip>
                            </v-list-item-subtitle>
                        </v-list-item-content>
                    </v-list-item>

                    <v-divider class="my-2"></v-divider>

                    <!-- 邮箱管理 -->
                    <v-list-group prepend-icon="mdi-email-multiple" value="true">
                        <template v-slot:activator>
                            <v-list-item-content>
                                <v-list-item-title>邮箱管理</v-list-item-title>
                                <v-list-item-subtitle>创建、刷新和管理邮箱</v-list-item-subtitle>
                            </v-list-item-content>
                        </template>
                        
                        <v-list-item @click="createNewEmail" class="mb-1">
                            <v-list-item-icon>
                                <v-icon color="green">mdi-plus-circle-outline</v-icon>
                            </v-list-item-icon>
                            <v-list-item-content>
                                <v-list-item-title>创建新邮箱</v-list-item-title>
                                <v-list-item-subtitle>获取新的临时邮箱</v-list-item-subtitle>
                            </v-list-item-content>
                        </v-list-item>
                        
                        <v-list-item @click="refreshMail" class="mb-1">
                            <v-list-item-icon>
                                <v-icon color="blue">mdi-refresh</v-icon>
                            </v-list-item-icon>
                            <v-list-item-content>
                                <v-list-item-title>刷新收件箱</v-list-item-title>
                                <v-list-item-subtitle>获取最新邮件</v-list-item-subtitle>
                            </v-list-item-content>
                        </v-list-item>
                        
                        <v-list-item @click="copyEmailToClipboard" class="mb-1">
                            <v-list-item-icon>
                                <v-icon color="orange">mdi-content-copy</v-icon>
                            </v-list-item-icon>
                            <v-list-item-content>
                                <v-list-item-title>复制邮箱地址</v-list-item-title>
                                <v-list-item-subtitle>复制到剪贴板</v-list-item-subtitle>
                            </v-list-item-content>
                        </v-list-item>
                        
                        <v-list-item @click="exportEmails(true)" class="mb-1">
                            <v-list-item-icon>
                                <v-icon color="purple">mdi-export</v-icon>
                            </v-list-item-icon>
                            <v-list-item-content>
                                <v-list-item-title>导出所有邮件</v-list-item-title>
                                <v-list-item-subtitle>导出为JSON文件</v-list-item-subtitle>
                            </v-list-item-content>
                        </v-list-item>
                    </v-list-group>

                    <v-divider class="my-2"></v-divider>

                    <!-- 邮件过滤器 -->
                    <v-list-group prepend-icon="mdi-filter" value="true">
                        <template v-slot:activator>
                            <v-list-item-content>
                                <v-list-item-title>邮件筛选</v-list-item-title>
                                <v-list-item-subtitle>按状态筛选邮件</v-list-item-subtitle>
                            </v-list-item-content>
                        </template>
                        
                        <v-list-item @click="setFilter('all')" class="mb-1">
                            <v-list-item-icon>
                                <v-icon :color="currentFilter === 'all' ? 'primary' : ''">mdi-email-multiple</v-icon>
                            </v-list-item-icon>
                            <v-list-item-content>
                                <v-list-item-title>全部邮件</v-list-item-title>
                                <v-list-item-subtitle>{{ messages.length }} 封</v-list-item-subtitle>
                            </v-list-item-content>
                            <v-list-item-action>
                                <v-chip small>{{ messages.length }}</v-chip>
                            </v-list-item-action>
                        </v-list-item>
                        
                        <v-list-item @click="setFilter('unread')" class="mb-1">
                            <v-list-item-icon>
                                <v-icon :color="currentFilter === 'unread' ? 'red' : ''">mdi-email</v-icon>
                            </v-list-item-icon>
                            <v-list-item-content>
                                <v-list-item-title>未读邮件</v-list-item-title>
                                <v-list-item-subtitle>{{ unreadCount }} 封未读</v-list-item-subtitle>
                            </v-list-item-content>
                            <v-list-item-action>
                                <v-chip small color="red" text-color="white">{{ unreadCount }}</v-chip>
                            </v-list-item-action>
                        </v-list-item>
                        
                        <v-list-item @click="setFilter('starred')" class="mb-1">
                            <v-list-item-icon>
                                <v-icon :color="currentFilter === 'starred' ? 'amber' : ''">mdi-star</v-icon>
                            </v-list-item-icon>
                            <v-list-item-content>
                                <v-list-item-title>星标邮件</v-list-item-title>
                                <v-list-item-subtitle>{{ starredCount }} 封</v-list-item-subtitle>
                            </v-list-item-content>
                            <v-list-item-action>
                                <v-chip small color="amber" text-color="white">{{ starredCount }}</v-chip>
                            </v-list-item-action>
                        </v-list-item>
                    </v-list-group>

                    <v-divider class="my-2"></v-divider>
                    <!-- 链接导航 - 折叠菜单 -->
<v-list-group prepend-icon="mdi-link-variant" value="true">
    <template v-slot:activator>
        <v-list-item-content>
            <v-list-item-title>相关链接</v-list-item-title>
            <v-list-item-subtitle>使用教程、官网及更多</v-list-item-subtitle>
        </v-list-item-content>
    </template>
    
    <a href="html/1.html" style="text-decoration: none; color: inherit; display: block;">
        <v-list-item class="mb-1">
            <v-list-item-icon>
                <v-icon color="blue">mdi-book-open-page-variant</v-icon>
            </v-list-item-icon>
            <v-list-item-content>
                <v-list-item-title>使用教程</v-list-item-title>
                <v-list-item-subtitle>查看详细使用指南</v-list-item-subtitle>
            </v-list-item-content>
        </v-list-item>
    </a>
    
    <a href="html/2.html" target="_blank" style="text-decoration: none; color: inherit; display: block;">
        <v-list-item class="mb-1">
            <v-list-item-icon>
                <v-icon color="green">mdi-web</v-icon>
            </v-list-item-icon>
            <v-list-item-content>
                <v-list-item-title>官方网站</v-list-item-title>
                <v-list-item-subtitle>访问项目官方站点</v-list-item-subtitle>
            </v-list-item-content>
        </v-list-item>
    </a>
    
    <a href="html/3.html" target="_blank" style="text-decoration: none; color: inherit; display: block;">
        <v-list-item class="mb-1">
            <v-list-item-icon>
                <v-icon color="purple">mdi-link</v-icon>
            </v-list-item-icon>
            <v-list-item-content>
                <v-list-item-title>其他链接</v-list-item-title>
                <v-list-item-subtitle>更多相关资源</v-list-item-subtitle>
            </v-list-item-content>
        </v-list-item>
    </a>
</v-list-group>

                    <v-divider class="my-2"></v-divider>
                    <!-- 设置 -->
                    <v-list-item @click="settingsDialog = true">
                        <v-list-item-icon>
                            <v-icon>mdi-cog-outline</v-icon>
                        </v-list-item-icon>
                        <v-list-item-content>
                            <v-list-item-title>设置</v-list-item-title>
                            <v-list-item-subtitle>应用设置和偏好</v-list-item-subtitle>
                        </v-list-item-content>
                    </v-list-item>

                    <!-- 关于 -->
                    <v-list-item @click="aboutDialog = true">
                        <v-list-item-icon>
                            <v-icon>mdi-information-outline</v-icon>
                        </v-list-item-icon>
                        <v-list-item-content>
                            <v-list-item-title>关于</v-list-item-title>
                            <v-list-item-subtitle>应用信息和帮助</v-list-item-subtitle>
                        </v-list-item-content>
                    </v-list-item>
                </v-list>
                
                <template v-slot:append>
                    <div class="pa-2">
                        <v-btn block color="primary" @click="showUserProfile">
                            <v-icon left>mdi-account</v-icon>
                            用户信息
                        </v-btn>
                    </div>
                </template>
            </v-navigation-drawer>

            <!-- 顶部工具栏 -->
            <v-app-bar app :color="settings.primaryColor" dark elevate-on-scroll>
                <v-app-bar-nav-icon @click="drawer = !drawer"></v-app-bar-nav-icon>
                <v-toolbar-title>
                    <v-icon left>mdi-email-fast-outline</v-icon>
                    临时邮箱
                </v-toolbar-title>
                
                <v-spacer></v-spacer>

                <!-- 过滤器快速切换 -->
                <div class="d-none d-md-flex">
                    <v-chip-group v-model="currentFilter" mandatory active-class="white--text">
                        <v-chip value="all" small>
                            <v-icon left small>mdi-email-multiple</v-icon>
                            全部 ({{ messages.length }})
                        </v-chip>
                        <v-chip value="unread" small color="red">
                            <v-icon left small>mdi-email</v-icon>
                            未读 ({{ unreadCount }})
                        </v-chip>
                        <v-chip value="starred" small color="amber">
                            <v-icon left small>mdi-star</v-icon>
                            星标 ({{ starredCount }})
                        </v-chip>
                    </v-chip-group>
                </div>

                <v-spacer></v-spacer>

                <!-- 当前邮箱显示 -->
                <v-menu bottom left offset-y v-if="currentEmail">
                    <template v-slot:activator="{ on, attrs }">
                        <v-chip v-bind="attrs" v-on="on" color="white" text-color="primary" class="mr-2 d-none d-sm-flex">
                            <v-avatar left>
                                <v-icon small>mdi-email-outline</v-icon>
                            </v-avatar>
                            {{ truncateEmail(currentEmail) }}
                        </v-chip>
                    </template>
                    <v-list>
                        <v-list-item @click="copyEmailToClipboard">
                            <v-list-item-icon>
                                <v-icon>mdi-content-copy</v-icon>
                            </v-list-item-icon>
                            <v-list-item-title>复制邮箱地址</v-list-item-title>
                        </v-list-item>
                        <v-list-item @click="showEmailDetails = !showEmailDetails">
                            <v-list-item-icon>
                                <v-icon>{{ showEmailDetails ? 'mdi-eye-off' : 'mdi-eye' }}</v-icon>
                            </v-list-item-icon>
                            <v-list-item-title>{{ showEmailDetails ? '隐藏邮箱详情' : '显示邮箱详情' }}</v-list-item-title>
                        </v-list-item>
                    </v-list>
                </v-menu>

                <v-btn icon @click="refreshMail" :loading="loadingMessages">
                    <v-icon>mdi-refresh</v-icon>
                </v-btn>
            </v-app-bar>

            <!-- 主内容区域 -->
            <v-main>
                <v-container fluid class="pa-0">
                    <!-- 邮箱创建区域 -->
                    <v-card v-if="!currentEmail" class="mx-auto my-12" max-width="600">
                        <v-card-title class="headline justify-center">
                            <v-icon large :color="settings.primaryColor" left>mdi-email-plus</v-icon>
                            创建临时邮箱
                        </v-card-title>
                        <v-card-subtitle class="text-center">
                            创建一个临时的、匿名的邮箱地址，用于接收邮件
                        </v-card-subtitle>
                        <v-card-text>
                            <v-stepper v-model="createStep" alt-labels>
                                <v-stepper-header>
                                    <v-stepper-step :complete="createStep > 1" step="1">
                                        基本信息
                                    </v-stepper-step>
                                    <v-divider></v-divider>
                                    <v-stepper-step :complete="createStep > 2" step="2">
                                        域名选择
                                    </v-stepper-step>
                                    <v-divider></v-divider>
                                    <v-stepper-step step="3">
                                        完成创建
                                    </v-stepper-step>
                                </v-stepper-header>

                                <v-stepper-items>
                                    <!-- 步骤1: 基本信息 -->
                                    <v-stepper-content step="1">
                                        <v-form ref="emailForm" v-model="formValid">
                                            <v-row>
                                                <v-col cols="12">
                                                    <v-text-field
                                                        v-model="newEmail.username"
                                                        label="用户名"
                                                        placeholder="留空则自动生成"
                                                        outlined
                                                        :rules="[v => !v || v.length >= 3 || '用户名至少3个字符']"
                                                        hint="可以自定义用户名前缀"
                                                        persistent-hint
                                                    >
                                                        <template v-slot:append>
                                                            <v-btn small text @click="generateUsername" color="primary">
                                                                随机生成
                                                            </v-btn>
                                                        </template>
                                                    </v-text-field>
                                                </v-col>
                                                <v-col cols="12">
                                                    <v-text-field
                                                        v-model="newEmail.password"
                                                        label="密码"
                                                        :type="showPassword ? 'text' : 'password'"
                                                        outlined
                                                        required
                                                        :rules="[v => !!v || '密码不能为空', v => v.length >= 6 || '密码至少6位']"
                                                        hint="用于保护你的邮箱"
                                                        persistent-hint
                                                        :append-icon="showPassword ? 'mdi-eye-off' : 'mdi-eye'"
                                                        @click:append="showPassword = !showPassword"
                                                    >
                                                        <template v-slot:append-outer>
                                                            <v-btn small text @click="generatePassword" color="primary">
                                                                生成密码
                                                            </v-btn>
                                                        </template>
                                                    </v-text-field>
                                                    <div class="d-flex align-center mt-2">
                                                        <div class="flex-grow-1">
                                                            <div class="password-strength-meter" :class="'password-strength-' + passwordStrength"></div>
                                                        </div>
                                                        <span class="caption ml-2">{{ passwordStrengthText }}</span>
                                                    </div>
                                                </v-col>
                                            </v-row>
                                        </v-form>
                                        <v-btn color="primary" @click="createStep = 2" :disabled="!formValid">
                                            下一步
                                        </v-btn>
                                    </v-stepper-content>

                                    <!-- 步骤2: 域名选择 -->
                                    <v-stepper-content step="2">
                                        <v-select
                                            v-model="newEmail.domain"
                                            :items="availableDomains"
                                            label="选择域名"
                                            outlined
                                            :loading="loadingDomains"
                                            hint="选择一个可用的临时邮箱域名"
                                            persistent-hint
                                        >
                                            <template v-slot:item="{ item }">
                                                <v-list-item-content>
                                                    <v-list-item-title>{{ item }}</v-list-item-title>
                                                    <v-list-item-subtitle>临时邮箱域名</v-list-item-subtitle>
                                                </v-list-item-content>
                                            </template>
                                        </v-select>
                                        <v-row>
                                            <v-col cols="6">
                                                <v-btn text @click="createStep = 1">
                                                    <v-icon left>mdi-arrow-left</v-icon>
                                                    上一步
                                                </v-btn>
                                            </v-col>
                                            <v-col cols="6" class="text-right">
                                                <v-btn color="primary" @click="createStep = 3">
                                                    下一步
                                                    <v-icon right>mdi-arrow-right</v-icon>
                                                </v-btn>
                                            </v-col>
                                        </v-row>
                                    </v-stepper-content>

                                    <!-- 步骤3: 完成创建 -->
                                    <v-stepper-content step="3">
                                        <div class="text-center">
                                            <v-icon size="60" color="green" class="mb-4">mdi-check-circle-outline</v-icon>
                                            <h3 class="headline mb-2">确认创建</h3>
                                            <p class="subtitle-1 mb-4">将创建邮箱地址:</p>
                                            <v-chip large color="primary" text-color="white" class="mb-4">
                                                {{ newEmail.username || 'auto' }}@{{ newEmail.domain || 'example.com' }}
                                            </v-chip>
                                            <v-alert type="info" dense class="mb-4">
                                                临时邮箱将在24小时后自动过期
                                            </v-alert>
                                            <p class="caption mb-6">点击确认创建临时邮箱</p>
                                        </div>
                                        <v-row>
                                            <v-col cols="6">
                                                <v-btn text @click="createStep = 2">
                                                    <v-icon left>mdi-arrow-left</v-icon>
                                                    返回修改
                                                </v-btn>
                                            </v-col>
                                            <v-col cols="6" class="text-right">
                                                <v-btn color="success" @click="createEmailAccount" :loading="creatingAccount">
                                                    确认创建
                                                    <v-icon right>mdi-check</v-icon>
                                                </v-btn>
                                            </v-col>
                                        </v-row>
                                    </v-stepper-content>
                                </v-stepper-items>
                            </v-stepper>
                        </v-card-text>
                    </v-card>

                    <!-- 邮箱内容区域 -->
                    <v-row v-if="currentEmail" class="ma-0">
                        <!-- 侧边栏（移动端隐藏） -->
                        <v-col cols="12" md="3" lg="2" class="d-none d-md-block pa-0">
                            <v-card flat height="100%" class="rounded-0">
                                <v-card-text class="pa-4">
                                    <div class="text-center mb-6">
                                        <v-avatar size="80" :color="settings.primaryColor" class="mb-2">
                                            <v-icon size="40" dark>mdi-email-outline</v-icon>
                                        </v-avatar>
                                        <h4 class="subtitle-1">{{ currentEmail }}</h4>
                                        <v-chip small color="green" text-color="white" class="mt-1">
                                            <v-icon small left>mdi-check</v-icon>
                                            已连接
                                        </v-chip>
                                    </div>

                                    <v-divider class="my-4"></v-divider>

                                    <div class="mb-4">
                                        <h4 class="overline mb-2">快速操作</h4>
                                        <v-btn block color="primary" class="mb-2" @click="copyEmailToClipboard">
                                            <v-icon left>mdi-content-copy</v-icon>
                                            复制邮箱
                                        </v-btn>
                                        <v-btn block outlined color="primary" class="mb-2" @click="refreshMail">
                                            <v-icon left>mdi-refresh</v-icon>
                                            刷新
                                        </v-btn>
                                        <v-btn block outlined color="error" @click="clearAllEmails">
                                            <v-icon left>mdi-delete-sweep</v-icon>
                                            清空收件箱
                                        </v-btn>
                                    </div>

                                    <v-divider class="my-4"></v-divider>

                                    <div>
                                        <h4 class="overline mb-2">邮件统计</h4>
                                        <v-list dense>
                                            <v-list-item>
                                                <v-list-item-icon>
                                                    <v-icon small>mdi-email-multiple</v-icon>
                                                </v-list-item-icon>
                                                <v-list-item-content>
                                                    <v-list-item-title>全部邮件</v-list-item-title>
                                                </v-list-item-content>
                                                <v-list-item-action>
                                                    <v-chip x-small>{{ messages.length }}</v-chip>
                                                </v-list-item-action>
                                            </v-list-item>
                                            <v-list-item>
                                                <v-list-item-icon>
                                                    <v-icon small color="red">mdi-email</v-icon>
                                                </v-list-item-icon>
                                                <v-list-item-content>
                                                    <v-list-item-title>未读邮件</v-list-item-title>
                                                </v-list-item-content>
                                                <v-list-item-action>
                                                    <v-chip x-small color="red" text-color="white">{{ unreadCount }}</v-chip>
                                                </v-list-item-action>
                                            </v-list-item>
                                            <v-list-item>
                                                <v-list-item-icon>
                                                    <v-icon small color="amber">mdi-star</v-icon>
                                                </v-list-item-icon>
                                                <v-list-item-content>
                                                    <v-list-item-title>星标邮件</v-list-item-title>
                                                </v-list-item-content>
                                                <v-list-item-action>
                                                    <v-chip x-small color="amber" text-color="white">{{ starredCount }}</v-chip>
                                                </v-list-item-action>
                                            </v-list-item>
                                        </v-list>
                                    </div>
                                </v-card-text>
                            </v-card>
                        </v-col>

                        <!-- 主内容区域 -->
                        <v-col cols="12" md="9" lg="10" class="pa-0">
                            <v-card flat height="100%" class="rounded-0">
                                <!-- 邮箱详情（可折叠） -->
                                <v-expand-transition>
                                    <div v-if="showEmailDetails" class="email-detail-header px-4 pt-4">
                                        <v-row align="center">
                                            <v-col cols="10">
                                                <h3 class="subtitle-1 mb-1">当前邮箱详情</h3>
                                                <v-chip-group>
                                                    <v-chip small color="primary" outlined>{{ currentEmail }}</v-chip>
                                                    <v-chip small color="green" outlined>已连接</v-chip>
                                                    <v-chip small color="blue" outlined>临时邮箱</v-chip>
                                                </v-chip-group>
                                            </v-col>
                                            <v-col cols="2" class="text-right">
                                                <v-btn icon small @click="showEmailDetails = false">
                                                    <v-icon>mdi-close</v-icon>
                                                </v-btn>
                                            </v-col>
                                        </v-row>
                                    </div>
                                </v-expand-transition>

                                <!-- 批量操作栏 - 优化后的响应式设计 -->
                                <div class="email-actions">
                                    <v-row align="center" class="flex-wrap">
                                        <v-col cols="12" sm="6" md="4" class="d-flex align-center">
                                            <v-checkbox
                                                v-model="selectAll"
                                                hide-details
                                                dense
                                                class="mr-2 mt-0 pt-0"
                                            ></v-checkbox>
                                            <span class="caption mr-4">{{ selectedEmails.length }} 封选中</span>
                                            <v-divider vertical class="mr-4 d-none d-sm-flex"></v-divider>
                                        </v-col>
                                        
                                        <v-col cols="12" sm="6" md="8" class="d-flex flex-wrap align-center">
                                            <v-btn 
                                                v-if="selectedEmails.length > 0" 
                                                text 
                                                small 
                                                color="primary" 
                                                @click="markSelectedAsRead"
                                                :disabled="markingAsRead"
                                                class="mr-1 mb-1"
                                            >
                                                <v-icon small left>mdi-check</v-icon>
                                                标记为已读
                                            </v-btn>
                                            <v-btn 
                                                v-if="selectedEmails.length > 0" 
                                                text 
                                                small 
                                                color="red" 
                                                @click="markSelectedAsUnread"
                                                class="mr-1 mb-1"
                                            >
                                                <v-icon small left>mdi-email</v-icon>
                                                标记为未读
                                            </v-btn>
                                            <v-btn 
                                                v-if="selectedEmails.length > 0" 
                                                text 
                                                small 
                                                color="amber" 
                                                @click="toggleStarSelected"
                                                class="mr-1 mb-1"
                                            >
                                                <v-icon small left>{{ allSelectedStarred ? 'mdi-star-off' : 'mdi-star' }}</v-icon>
                                                {{ allSelectedStarred ? '取消星标' : '标记星标' }}
                                            </v-btn>
                                            <v-btn 
                                                v-if="selectedEmails.length > 0" 
                                                text 
                                                small 
                                                color="error" 
                                                @click="deleteSelectedEmails"
                                                class="mr-1 mb-1"
                                            >
                                                <v-icon small left>mdi-delete</v-icon>
                                                删除选中
                                            </v-btn>
                                        </v-col>
                                    </v-row>
                                </div>

                                <!-- 收件箱标题和搜索栏 -->
                                <v-card-title class="d-flex flex-wrap align-center">
                                    <div class="d-flex align-center mr-4 mb-2 mb-sm-0">
                                        <v-icon left>mdi-inbox</v-icon>
                                        收件箱
                                    </div>
                                    <v-spacer></v-spacer>
                                    <div class="d-flex flex-wrap align-center">
                                        <v-text-field
                                            v-model="searchQuery"
                                            placeholder="搜索邮件..."
                                            prepend-inner-icon="mdi-magnify"
                                            outlined
                                            dense
                                            hide-details
                                            class="mr-2 mb-2 mb-sm-0"
                                            style="max-width: 200px;"
                                        ></v-text-field>
 
  <!-- 复制邮箱 -->                                       
 <v-btn 
    v-if="currentEmail"
    small
    @click="copyEmailToClipboard"
    class="mr-2 mb-2 mb-sm-0"
    style="background: linear-gradient(135deg, #FB7299 0%, #36A8FF 100%) !important; color: white !important; border: none !important; box-shadow: 0 4px 15px rgba(251, 114, 153, 0.4) !important; transition: all 0.3s ease !important;"
    @mouseover="$event.target.style.background = 'linear-gradient(135deg, #F56298 0%, #2D9CFF 100%)'"
    @mouseout="$event.target.style.background = 'linear-gradient(135deg, #FB7299 0%, #36A8FF 100%)'"
>
    <v-icon left small>mdi-content-copy</v-icon>
    复制邮箱
</v-btn>

                                        <div class="d-flex align-center">
                                            <v-btn-toggle v-model="currentFilter" mandatory dense class="mr-2">
                                                <v-btn value="all" small>
                                                    全部
                                                    <v-chip x-small class="ml-1">{{ messages.length }}</v-chip>
                                                </v-btn>
                                                <v-btn value="unread" small color="red">
                                                    未读
                                                    <v-chip x-small color="red" text-color="white" class="ml-1">{{ unreadCount }}</v-chip>
                                                </v-btn>
                                                <v-btn value="starred" small color="amber">
                                                    星标
                                                    <v-chip x-small color="amber" text-color="white" class="ml-1">{{ starredCount }}</v-chip>
                                                </v-btn>
                                            </v-btn-toggle>
                                            <v-btn icon @click="toggleViewMode" class="mb-2 mb-sm-0">
                                                <v-icon>{{ viewMode === 'list' ? 'mdi-view-grid' : 'mdi-view-list' }}</v-icon>
                                            </v-btn>
                                        </div>
                                    </div>
                                </v-card-title>

                                <v-divider></v-divider>

                                <!-- 邮件列表/网格视图 -->
                                <v-card-text class="pa-0" style="min-height: 500px;">
                                    <!-- 列表视图 -->
                                    <template v-if="viewMode === 'list'">
                                        <v-list three-line class="pa-0" v-if="filteredMessages.length > 0">
                                            <template v-for="(email, index) in paginatedMessages">
                                                <v-divider v-if="index > 0" :key="`divider-${email.id}`"></v-divider>
                                                <v-list-item 
                                                    :key="email.id"
                                                    @click="viewEmail(email)"
                                                    :class="{'email-list-item': true, 'unread-bg': !email.isRead}"
                                                    :style="{ backgroundColor: !email.isRead ? '#fff8e1' : 'white' }"
                                                >
                                                    <v-list-item-avatar>
                                                        <div class="sender-avatar">
                                                            {{ getSenderInitial(email.from.name || email.from.address) }}
                                                        </div>
                                                    </v-list-item-avatar>

                                                    <v-list-item-content>
                                                        <v-list-item-title>
                                                            <span :class="{'unread': !email.isRead}">
                                                                {{ email.from.name || email.from.address }}
                                                            </span>
                                                            <v-chip 
                                                                v-if="email.isStarred" 
                                                                x-small 
                                                                color="amber" 
                                                                text-color="white" 
                                                                class="ml-2"
                                                            >
                                                                <v-icon x-small>mdi-star</v-icon>
                                                            </v-chip>
                                                            <v-chip 
                                                                v-if="hasAttachments(email)" 
                                                                x-small 
                                                                color="blue" 
                                                                text-color="white" 
                                                                class="ml-2"
                                                            >
                                                                <v-icon x-small>mdi-paperclip</v-icon>
                                                            </v-chip>
                                                        </v-list-item-title>
                                                        <v-list-item-subtitle>
                                                            <span :class="{'email-subject': true, 'unread': !email.isRead}">
                                                                {{ email.subject || '(无主题)' }}
                                                            </span>
                                                        </v-list-item-subtitle>
                                                        <div class="email-preview">
                                                            {{ getEmailPreview(email) }}
                                                        </div>
                                                    </v-list-item-content>

                                                    <v-list-item-action>
                                                        <div class="text-right">
                                                            <div class="caption mb-1" :class="{'unread': !email.isRead}">
                                                                {{ formatRelativeTime(email.createdAt) }}
                                                            </div>
                                                            <div>
                                                                <v-checkbox
                                                                    v-model="selectedEmails"
                                                                    :value="email.id"
                                                                    hide-details
                                                                    class="mt-0"
                                                                    dense
                                                                ></v-checkbox>
                                                            </div>
                                                        </div>
                                                    </v-list-item-action>
                                                </v-list-item>
                                            </template>
                                        </v-list>
                                        
                                        <!-- 空状态 -->
                                        <div v-else class="text-center py-12">
                                            <v-icon size="80" color="grey lighten-2" class="mb-4">mdi-email-open-outline</v-icon>
                                            <h3 class="headline mb-2">没有找到邮件</h3>
                                            <p class="subtitle-1 mb-6" v-if="searchQuery">
                                                没有匹配 "{{ searchQuery }}" 的邮件
                                            </p>
                                            <p class="subtitle-1 mb-6" v-else-if="currentFilter === 'unread'">
                                                所有邮件都已读
                                            </p>
                                            <p class="subtitle-1 mb-6" v-else-if="currentFilter === 'starred'">
                                                没有星标邮件
                                            </p>
                                            <p class="subtitle-1 mb-6" v-else>
                                                收件箱为空，等待接收邮件...
                                            </p>
                                            <v-btn color="primary" @click="refreshMail">
                                                <v-icon left>mdi-refresh</v-icon>
                                                刷新收件箱
                                            </v-btn>
                                        </div>
                                    </template>

                                    <!-- 网格视图 -->
                                    <template v-else>
                                        <v-container fluid v-if="filteredMessages.length > 0">
                                            <v-row>
                                                <v-col 
                                                    v-for="email in paginatedMessages" 
                                                    :key="email.id" 
                                                    cols="12" 
                                                    sm="6" 
                                                    md="4" 
                                                    lg="3"
                                                >
                                                    <v-card 
                                                        @click="viewEmail(email)"
                                                        :class="{'unread-border': !email.isRead}"
                                                        :style="{ borderLeft: !email.isRead ? '4px solid #d32f2f' : '' }"
                                                    >
                                                        <v-card-title class="py-2">
                                                            <div class="d-flex align-center justify-space-between w-100">
                                                                <div class="sender-avatar-small mr-2">
                                                                    {{ getSenderInitial(email.from.name || email.from.address) }}
                                                                </div>
                                                                <div class="flex-grow-1">
                                                                    <div class="text-truncate font-weight-medium" :class="{'unread': !email.isRead}">
                                                                        {{ email.from.name || email.from.address }}
                                                                    </div>
                                                                </div>
                                                                <v-checkbox
                                                                    v-model="selectedEmails"
                                                                    :value="email.id"
                                                                    hide-details
                                                                    dense
                                                                    class="mt-0"
                                                                    @click.stop
                                                                ></v-checkbox>
                                                            </div>
                                                        </v-card-title>
                                                        <v-card-text class="py-2">
                                                            <div class="text-truncate font-weight-bold mb-1" :class="{'email-subject': true, 'unread': !email.isRead}">
                                                                {{ email.subject || '(无主题)' }}
                                                            </div>
                                                            <div class="caption text-truncate mb-2">
                                                                {{ getEmailPreview(email) }}
                                                            </div>
                                                            <div class="d-flex justify-space-between align-center">
                                                                <div class="caption" :class="{'unread': !email.isRead}">
                                                                    {{ formatRelativeTime(email.createdAt) }}
                                                                </div>
                                                                <div>
                                                                    <v-icon 
                                                                        v-if="email.isStarred" 
                                                                        small 
                                                                        color="amber"
                                                                        @click.stop="toggleStar(email.id)"
                                                                    >
                                                                        mdi-star
                                                                    </v-icon>
                                                                    <v-icon 
                                                                        v-if="hasAttachments(email)" 
                                                                        small 
                                                                        color="blue"
                                                                        class="ml-1"
                                                                    >
                                                                        mdi-paperclip
                                                                    </v-icon>
                                                                </div>
                                                            </div>
                                                        </v-card-text>
                                                    </v-card>
                                                </v-col>
                                            </v-row>
                                        </v-container>
                                        
                                        <!-- 空状态 -->
                                        <div v-else class="text-center py-12">
                                            <v-icon size="80" color="grey lighten-2" class="mb-4">mdi-email-open-outline</v-icon>
                                            <h3 class="headline mb-2">没有找到邮件</h3>
                                            <p class="subtitle-1 mb-6" v-if="searchQuery">
                                                没有匹配 "{{ searchQuery }}" 的邮件
                                            </p>
                                            <p class="subtitle-1 mb-6" v-else-if="currentFilter === 'unread'">
                                                所有邮件都已读
                                            </p>
                                            <p class="subtitle-1 mb-6" v-else-if="currentFilter === 'starred'">
                                                没有星标邮件
                                            </p>
                                            <p class="subtitle-1 mb-6" v-else>
                                                收件箱为空，等待接收邮件...
                                            </p>
                                        </div>
                                    </template>
                                </v-card-text>

                                <!-- 分页 -->
                                <v-divider></v-divider>
                                <v-card-actions v-if="filteredMessages.length > 0">
                                    <div class="caption ml-2">
                                        显示 {{ (currentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentPage * itemsPerPage, filteredMessages.length) }} / {{ filteredMessages.length }} 封邮件
                                    </div>
                                    <v-spacer></v-spacer>
                                    <v-pagination
                                        v-model="currentPage"
                                        :length="Math.ceil(filteredMessages.length / itemsPerPage)"
                                        total-visible="5"
                                        circle
                                    ></v-pagination>
                                </v-card-actions>
                            </v-card>
                        </v-col>
                    </v-row>
                </container>

                <!-- 邮件详情对话框 -->
                <v-dialog v-model="emailDetailDialog" max-width="800" fullscreen>
                    <v-card v-if="currentEmailDetail">
                        <v-toolbar :color="settings.primaryColor" dark>
                            <v-btn icon @click="emailDetailDialog = false">
                                <v-icon>mdi-close</v-icon>
                            </v-btn>
                            <v-toolbar-title>
                                {{ currentEmailDetail.subject || '(无主题)' }}
                            </v-toolbar-title>
                            <v-spacer></v-spacer>
                            <v-toolbar-items>
                                <v-btn icon @click="toggleStar(currentEmailDetail.id)">
                                    <v-icon :color="currentEmailDetail.isStarred ? 'amber' : ''">
                                        {{ currentEmailDetail.isStarred ? 'mdi-star' : 'mdi-star-outline' }}
                                    </v-icon>
                                </v-btn>
                                <v-btn icon @click="deleteEmail(currentEmailDetail.id)">
                                    <v-icon>mdi-delete</v-icon>
                                </v-btn>
                            </v-toolbar-items>
                        </v-toolbar>

                        <v-card-text class="pa-4">
                            <!-- 邮件头信息 -->
                            <div class="email-detail-header mb-6">
                                <v-row>
                                    <v-col cols="12">
                                        <div class="d-flex align-center mb-2">
                                            <div class="sender-avatar mr-3">
                                                {{ getSenderInitial(currentEmailDetail.from.name || currentEmailDetail.from.address) }}
                                            </div>
                                            <div class="flex-grow-1">
                                                <h4 class="headline mb-1">
                                                    {{ currentEmailDetail.subject || '(无主题)' }}
                                                </h4>
                                                <div class="subtitle-1">
                                                    <strong>发件人:</strong> {{ currentEmailDetail.from.name || currentEmailDetail.from.address }}
                                                </div>
                                                <div class="caption">
                                                    <strong>收件人:</strong> {{ currentEmailDetail.to[0].address }}
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="subtitle-1">
                                                    {{ formatDate(currentEmailDetail.createdAt) }}
                                                </div>
                                                <div class="caption">
                                                    {{ formatRelativeTime(currentEmailDetail.createdAt) }}
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 邮件标签 -->
                                        <div class="email-tags">
                                            <v-chip small class="mr-1 mb-1" :class="currentEmailDetail.isRead ? 'v-chip--read' : 'v-chip--unread'">
                                                {{ currentEmailDetail.isRead ? '已读' : '未读' }}
                                            </v-chip>
                                            <v-chip small color="amber" text-color="white" class="mr-1 mb-1" v-if="currentEmailDetail.isStarred">
                                                <v-icon x-small left>mdi-star</v-icon>
                                                星标
                                            </v-chip>
                                            <v-chip small color="blue" text-color="white" class="mr-1 mb-1" v-if="hasAttachments(currentEmailDetail)">
                                                <v-icon x-small left>mdi-paperclip</v-icon>
                                                附件
                                            </v-chip>
                                            <v-chip small color="green" text-color="white" class="mr-1 mb-1">
                                                临时邮箱
                                            </v-chip>
                                        </div>
                                    </v-col>
                                </v-row>
                            </div>

                            <!-- 邮件内容 -->
                            <div class="email-content mb-6">
                                <div v-html="formatEmailContent(currentEmailDetail)"></div>
                            </div>

                            <!-- 附件区域 -->
                            <div v-if="hasAttachments(currentEmailDetail)" class="mb-6">
                                <h4 class="overline mb-2">
                                    <v-icon small left>mdi-paperclip</v-icon>
                                    附件 ({{ getAttachmentCount(currentEmailDetail) }})
                                </h4>
                                <div class="d-flex flex-wrap">
                                    <v-chip
                                        v-for="(attachment, index) in getAttachments(currentEmailDetail)"
                                        :key="index"
                                        class="attachment-chip"
                                        close
                                        @click:close="downloadAttachment(attachment)"
                                        @click="downloadAttachment(attachment)"
                                    >
                                        <v-icon left small>mdi-file-outline</v-icon>
                                        {{ attachment.filename || '附件' }} ({{ formatFileSize(attachment.size) }})
                                    </v-chip>
                                </div>
                            </div>

                            <!-- 邮件原始信息 -->
                            <v-expansion-panels accordion flat>
                                <v-expansion-panel>
                                    <v-expansion-panel-header>
                                        <v-icon left small>mdi-information-outline</v-icon>
                                        邮件原始信息
                                    </v-expansion-panel-header>
                                    <v-expansion-panel-content>
                                        <pre style="font-size: 12px; overflow: auto; max-height: 300px;">{{ JSON.stringify(currentEmailDetail, null, 2) }}</pre>
                                    </v-expansion-panel-content>
                                </v-expansion-panel>
                            </v-expansion-panels>
                        </v-card-text>

                        <v-card-actions class="pa-4">
                            <v-spacer></v-spacer>
                            <v-btn @click="markAsUnread(currentEmailDetail.id)" v-if="currentEmailDetail.isRead">
                                <v-icon left>mdi-email</v-icon>
                                标记为未读
                            </v-btn>
                            <v-btn @click="exportEmails(false, currentEmailDetail)" color="primary" class="ml-2">
                                <v-icon left>mdi-export</v-icon>
                                导出邮件
                            </v-btn>
                            <v-btn @click="emailDetailDialog = false" class="ml-2">
                                关闭
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- 用户信息对话框 -->
                <v-dialog v-model="userProfileDialog" max-width="600">
                    <v-card>
                        <v-card-title class="headline">
                            <v-icon left>mdi-account</v-icon>
                            邮箱账户信息
                        </v-card-title>
                        <v-card-text>
                            <div v-if="currentEmail" class="email-account-info">
                                <div class="text-center mb-4">
                                    <v-avatar size="80" color="white" class="mb-2">
                                        <v-icon size="40" color="primary">mdi-email-outline</v-icon>
                                    </v-avatar>
                                    <h3 class="headline white--text">{{ currentEmail }}</h3>
                                    <v-chip color="white" text-color="primary" small class="mt-2">
                                        <v-icon small left>mdi-check</v-icon>
                                        当前活跃
                                    </v-chip>
                                </div>
                            </div>

                            <v-row class="mt-4">
                                <v-col cols="12" sm="6">
                                    <v-card class="stats-card" elevation="2">
                                        <v-card-text class="text-center">
                                            <v-icon large color="primary" class="mb-2">mdi-calendar</v-icon>
                                            <h4 class="subtitle-1">创建时间</h4>
                                            <p class="body-2">{{ accountInfo.createdAt ? formatDate(accountInfo.createdAt) : '未知' }}</p>
                                        </v-card-text>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6">
                                    <v-card class="stats-card" elevation="2">
                                        <v-card-text class="text-center">
                                            <v-icon large color="green" class="mb-2">mdi-clock-outline</v-icon>
                                            <h4 class="subtitle-1">使用时长</h4>
                                            <p class="body-2">{{ accountInfo.usageTime || '0分钟' }}</p>
                                        </v-card-text>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6">
                                    <v-card class="stats-card" elevation="2">
                                        <v-card-text class="text-center">
                                            <v-icon large color="blue" class="mb-2">mdi-email-multiple</v-icon>
                                            <h4 class="subtitle-1">总邮件数</h4>
                                            <p class="body-2">{{ messages.length }}</p>
                                        </v-card-text>
                                    </v-card>
                                </v-col>
                                <v-col cols="12" sm="6">
                                    <v-card class="stats-card" elevation="2">
                                        <v-card-text class="text-center">
                                            <v-icon large color="red" class="mb-2">mdi-email</v-icon>
                                            <h4 class="subtitle-1">未读邮件</h4>
                                            <p class="body-2">{{ unreadCount }}</p>
                                        </v-card-text>
                                    </v-card>
                                </v-col>
                            </v-row>

                            <div class="mt-6">
                                <v-alert type="info" dense>
                                    临时邮箱通常在24小时后过期，建议及时处理重要邮件。
                                </v-alert>
                            </div>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn @click="userProfileDialog = false" color="primary">
                                关闭
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- 设置对话框 -->
                <v-dialog v-model="settingsDialog" max-width="600" scrollable>
                    <v-card>
                        <v-card-title class="headline">
                            <v-icon left>mdi-cog</v-icon>
                            设置
                        </v-card-title>
                        <v-card-text>
                            <v-tabs v-model="settingsTab" grow>
                                <v-tab>显示设置</v-tab>
                                <v-tab>主题设置</v-tab>
                                <v-tab>数据管理</v-tab>
                            </v-tabs>

                            <v-tabs-items v-model="settingsTab" class="mt-4">
                                <!-- 显示设置 -->
                                <v-tab-item>
                                    <v-list>
                                        <!-- 自动刷新设置 -->
                                        <v-list-item>
                                            <v-list-item-icon>
                                                <v-icon>mdi-refresh</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>自动刷新邮件</v-list-item-title>
                                                <v-list-item-subtitle>每隔指定时间自动刷新收件箱</v-list-item-subtitle>
                                            </v-list-item-content>
                                            <v-list-item-action>
                                                <v-switch
                                                    v-model="settings.autoRefresh"
                                                    hide-details
                                                    @change="saveSettings"
                                                ></v-switch>
                                            </v-list-item-action>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 刷新间隔 -->
                                        <v-list-item v-if="settings.autoRefresh">
                                            <v-list-item-icon>
                                                <v-icon>mdi-timer</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>刷新间隔</v-list-item-title>
                                                <v-list-item-subtitle>自动刷新邮件的时间间隔</v-list-item-subtitle>
                                            </v-list-item-content>
                                            <v-list-item-action style="min-width: 100px;">
                                                <v-select
                                                    v-model="settings.refreshInterval"
                                                    :items="[10, 30, 60, 120, 300]"
                                                    dense
                                                    hide-details
                                                    suffix="秒"
                                                    @change="saveSettings"
                                                ></v-select>
                                            </v-list-item-action>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 邮件显示设置 -->
                                        <v-list-item>
                                            <v-list-item-icon>
                                                <v-icon>mdi-email-open</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>打开邮件时标记为已读</v-list-item-title>
                                                <v-list-item-subtitle>查看邮件时自动标记为已读状态</v-list-item-subtitle>
                                            </v-list-item-content>
                                            <v-list-item-action>
                                                <v-switch
                                                    v-model="settings.markAsReadOnOpen"
                                                    hide-details
                                                    @change="saveSettings"
                                                ></v-switch>
                                            </v-list-item-action>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 默认视图 -->
                                        <v-list-item>
                                            <v-list-item-icon>
                                                <v-icon>mdi-view-list</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>默认视图模式</v-list-item-title>
                                                <v-list-item-subtitle>邮件列表的默认显示方式</v-list-item-subtitle>
                                            </v-list-item-content>
                                            <v-list-item-action style="min-width: 100px;">
                                                <v-select
                                                    v-model="settings.defaultViewMode"
                                                    :items="[
                                                        { text: '列表视图', value: 'list' },
                                                        { text: '网格视图', value: 'grid' }
                                                    ]"
                                                    dense
                                                    hide-details
                                                    @change="saveSettings"
                                                ></v-select>
                                            </v-list-item-action>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 邮件排序 -->
                                        <v-list-item>
                                            <v-list-item-icon>
                                                <v-icon>mdi-sort</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>邮件排序方式</v-list-item-title>
                                                <v-list-item-subtitle>邮件列表的排序规则</v-list-item-subtitle>
                                            </v-list-item-content>
                                            <v-list-item-action style="min-width: 120px;">
                                                <v-select
                                                    v-model="settings.sortOrder"
                                                    :items="[
                                                        { text: '最新优先', value: 'desc' },
                                                        { text: '最早优先', value: 'asc' }
                                                    ]"
                                                    dense
                                                    hide-details
                                                    @change="saveSettings"
                                                ></v-select>
                                            </v-list-item-action>
                                        </v-list-item>
                                    </v-list>
                                </v-tab-item>

                                <!-- 主题设置 -->
                                <v-tab-item>
                                    <v-list>
                                        <!-- 深色模式 -->
                                        <v-list-item>
                                            <v-list-item-icon>
                                                <v-icon>mdi-theme-light-dark</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>深色模式</v-list-item-title>
                                                <v-list-item-subtitle>切换深色/浅色主题</v-list-item-subtitle>
                                            </v-list-item-content>
                                            <v-list-item-action>
                                                <v-switch
                                                    v-model="settings.darkMode"
                                                    hide-details
                                                    @change="saveSettings"
                                                ></v-switch>
                                            </v-list-item-action>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 主题颜色 -->
                                        <v-list-item>
                                            <v-list-item-icon>
                                                <v-icon>mdi-palette</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>主题颜色</v-list-item-title>
                                                <v-list-item-subtitle>选择应用的主题颜色</v-list-item-subtitle>
                                            </v-list-item-content>
                                            <v-list-item-action style="min-width: 120px;">
                                                <v-select
                                                    v-model="settings.primaryColor"
                                                    :items="themeColors"
                                                    dense
                                                    hide-details
                                                    @change="saveSettings"
                                                ></v-select>
                                            </v-list-item-action>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 颜色预览 -->
                                        <v-list-item>
                                            <v-list-item-content>
                                                <div class="d-flex align-center">
                                                    <div class="mr-4">
                                                        <div class="color-preview" :style="{ backgroundColor: getColorValue(settings.primaryColor) }"></div>
                                                    </div>
                                                    <div>
                                                        <v-list-item-title>颜色预览</v-list-item-title>
                                                        <v-list-item-subtitle>当前主题颜色</v-list-item-subtitle>
                                                    </div>
                                                </div>
                                            </v-list-item-content>
                                        </v-list-item>
                                    </v-list>
                                </v-tab-item>

                                <!-- 数据管理 -->
                                <v-tab-item>
                                    <v-list>
                                        <!-- 导出数据 -->
                                        <v-list-item @click="exportAllData">
                                            <v-list-item-icon>
                                                <v-icon color="green">mdi-export</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>导出所有数据</v-list-item-title>
                                                <v-list-item-subtitle>导出设置、邮件状态等所有数据</v-list-item-subtitle>
                                            </v-list-item-content>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 导出邮件 -->
                                        <v-list-item @click="exportEmails(true)">
                                            <v-list-item-icon>
                                                <v-icon color="blue">mdi-email-export</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>导出所有邮件</v-list-item-title>
                                                <v-list-item-subtitle>导出当前邮箱的所有邮件数据</v-list-item-subtitle>
                                            </v-list-item-content>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 清除数据 -->
                                        <v-list-item @click="clearAllData">
                                            <v-list-item-icon>
                                                <v-icon color="red">mdi-delete-sweep</v-icon>
                                            </v-list-item-icon>
                                            <v-list-item-content>
                                                <v-list-item-title>清除所有本地数据</v-list-item-title>
                                                <v-list-item-subtitle>清除所有本地存储的数据</v-list-item-subtitle>
                                            </v-list-item-content>
                                        </v-list-item>

                                        <v-divider></v-divider>

                                        <!-- 数据统计 -->
                                        <v-list-item>
                                            <v-list-item-content>
                                                <v-list-item-title>数据统计</v-list-item-title>
                                                <v-list-item-subtitle>当前本地存储的数据量</v-list-item-subtitle>
                                                <div class="mt-2">
                                                    <v-chip small class="mr-2">设置: {{ localStorageSize.settings }} KB</v-chip>
                                                    <v-chip small class="mr-2">邮件状态: {{ localStorageSize.emailStatus }} KB</v-chip>
                                                    <v-chip small>账户信息: {{ localStorageSize.accountInfo }} KB</v-chip>
                                                </div>
                                            </v-list-item-content>
                                        </v-list-item>
                                    </v-list>
                                </v-tab-item>
                            </v-tabs-items>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn @click="settingsDialog = false" color="primary">
                                关闭
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- 关于对话框 -->
                <v-dialog v-model="aboutDialog" max-width="500">
                    <v-card>
                        <v-card-title class="headline">
                            <v-icon left large :color="settings.primaryColor">mdi-email-fast-outline</v-icon>
                            关于临时邮箱
                        </v-card-title>
                        <v-card-text>
                            <div class="text-center mb-4">
                                <v-avatar size="80" :color="settings.primaryColor" class="mb-2">
                                    <v-icon size="40" dark>mdi-email-fast-outline</v-icon>
                                </v-avatar>
                                <h3 class="headline">临时邮箱</h3>
                                <p class="subtitle-1">版本 1.0.0</p>
                            </div>
                            
                            <p>这是一个基于Vuetify框架的临时邮箱网页应用，使用API提供临时邮箱服务。</p>
                            <p>开发者：Aaa</p>
                            <p>辅助：deepseek</p>
                            <p>邮箱：li331066@163.com</p>
                            <h4 class="overline mt-4 mb-2">主要功能</h4>
                            <v-list dense>
                                <v-list-item>
                                    <v-list-item-icon>
                                        <v-icon small color="green">mdi-check</v-icon>
                                    </v-list-item-icon>
                                    <v-list-item-content>
                                        <v-list-item-title>创建临时邮箱账户</v-list-item-title>
                                    </v-list-item-content>
                                </v-list-item>
                                <v-list-item>
                                    <v-list-item-icon>
                                        <v-icon small color="green">mdi-check</v-icon>
                                    </v-list-item-icon>
                                    <v-list-item-content>
                                        <v-list-item-title>接收和查看邮件</v-list-item-title>
                                    </v-list-item-content>
                                </v-list-item>
                                <v-list-item>
                                    <v-list-item-icon>
                                        <v-icon small color="green">mdi-check</v-icon>
                                    </v-list-item-icon>
                                    <v-list-item-content>
                                        <v-list-item-title>邮件筛选和搜索</v-list-item-title>
                                    </v-list-item-content>
                                </v-list-item>
                                <v-list-item>
                                    <v-list-item-icon>
                                        <v-icon small color="green">mdi-check</v-icon>
                                    </v-list-item-icon>
                                    <v-list-item-content>
                                        <v-list-item-title>批量邮件操作</v-list-item-title>
                                    </v-list-item-content>
                                </v-list-item>
                                <v-list-item>
                                    <v-list-item-icon>
                                        <v-icon small color="green">mdi-check</v-icon>
                                    </v-list-item-icon>
                                    <v-list-item-content>
                                        <v-list-item-title>邮件导出功能</v-list-item-title>
                                    </v-list-item-content>
                                </v-list-item>
                                <v-list-item>
                                    <v-list-item-icon>
                                        <v-icon small color="green">mdi-check</v-icon>
                                    </v-list-item-icon>
                                    <v-list-item-content>
                                        <v-list-item-title>主题颜色切换</v-list-item-title>
                                    </v-list-item-content>
                                </v-list-item>
                                <v-list-item>
                                    <v-list-item-icon>
                                        <v-icon small color="green">mdi-check</v-icon>
                                    </v-list-item-icon>
                                    <v-list-item-content>
                                        <v-list-item-title>响应式设计</v-list-item-title>
                                    </v-list-item-content>
                                </v-list-item>
                            </v-list>

                            <div class="mt-6">
                                <p class="caption text--secondary">
                                    注意：临时邮箱适用于需要临时邮箱地址的场景，不适合长期使用。邮件可能会在24小时后自动删除。
                                </p>
                            </div>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn @click="aboutDialog = false" color="primary">
                                关闭
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>
            </v-main>

            <!-- 底部导航栏（移动端） -->
            <v-bottom-navigation v-if="currentEmail" app grow :color="settings.primaryColor" class="d-md-none">
                <v-btn @click="showInbox">
                    <span>收件箱</span>
                    <v-badge
                        :content="unreadCount"
                        :value="unreadCount"
                        color="red"
                        overlap
                    >
                        <v-icon>mdi-inbox</v-icon>
                    </v-badge>
                </v-btn>
                <v-btn @click="createNewEmail">
                    <span>新建</span>
                    <v-icon>mdi-email-plus</v-icon>
                </v-btn>
                <v-btn @click="showUserProfile">
                    <span>用户</span>
                    <v-icon>mdi-account</v-icon>
                </v-btn>
                <v-btn @click="settingsDialog = true">
                    <span>设置</span>
                    <v-icon>mdi-cog</v-icon>
                </v-btn>
            </v-bottom-navigation>

            <!-- 消息提示 -->
            <v-snackbar v-model="snackbar.show" :color="snackbar.color" :timeout="3000" bottom right>
                {{ snackbar.text }}
                <template v-slot:action="{ attrs }">
                    <v-btn text v-bind="attrs" @click="snackbar.show = false">
                        关闭
                    </v-btn>
                </template>
            </v-snackbar>
        </v-app>
    </div>
    <script src="special-effects.js"></script>

    <!-- Vue和Vuetify库 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script>
        new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data: () => ({
                // 侧边栏控制
                drawer: false,
                
                // 邮箱相关
                currentEmail: null,
                currentToken: null,
                availableDomains: [],
                loadingDomains: false,
                creatingAccount: false,
                createStep: 1,
                formValid: false,
                showEmailDetails: false,
                showPassword: false,
                
                // 邮件列表和筛选
                messages: [],
                loadingMessages: false,
                searchQuery: '',
                currentFilter: 'all',
                currentPage: 1,
                itemsPerPage: 50,
                viewMode: 'list',
                selectedEmails: [],
                
                // 邮件详情
                currentEmailDetail: null,
                emailDetailDialog: false,
                
                // 用户信息
                userProfileDialog: false,
                accountInfo: {
                    createdAt: null,
                    usageTime: '0分钟'
                },
                
                // 设置
                settingsDialog: false,
                settingsTab: 0,
                settings: {
                    autoRefresh: true,
                    refreshInterval: 30,
                    markAsReadOnOpen: true,
                    defaultViewMode: 'list',
                    sortOrder: 'desc',
                    primaryColor: 'primary',
                    darkMode: false
                },
                themeColors: [
                    { text: '蓝色', value: 'primary' },
                    { text: '绿色', value: 'green' },
                    { text: '红色', value: 'red' },
                    { text: '橙色', value: 'orange' },
                    { text: '紫色', value: 'purple' },
                    { text: '青色', value: 'teal' },
                    { text: '粉色', value: 'pink' }
                ], // 主题颜色
                refreshTimer: null,
                
                // 关于
                aboutDialog: false,
                
                // 新建邮箱
                newEmail: {
                    username: '',
                    domain: '',
                    password: ''
                },
                
                // 消息提示
                snackbar: {
                    show: false,
                    text: '',
                    color: 'success'
                }
            }),
            computed: {
                unreadCount() {
                    return this.messages.filter(msg => !msg.isRead).length;
                },
                starredCount() {
                    return this.messages.filter(msg => msg.isStarred).length;
                },
                selectAll: {
                    get() {
                        return this.selectedEmails.length === this.filteredMessages.length && this.filteredMessages.length > 0;
                    },
                    set(value) {
                        if (value) {
                            this.selectedEmails = this.filteredMessages.map(msg => msg.id);
                        } else {
                            this.selectedEmails = [];
                        }
                    }
                },
                allSelectedStarred() {
                    if (this.selectedEmails.length === 0) return false;
                    return this.selectedEmails.every(id => {
                        const email = this.messages.find(msg => msg.id === id);
                        return email && email.isStarred;
                    });
                },
                passwordStrength() {
                    const password = this.newEmail.password;
                    if (!password) return 0;
                    
                    let strength = 0;
                    if (password.length >= 8) strength++;
                    if (/[A-Z]/.test(password)) strength++;
                    if (/[a-z]/.test(password)) strength++;
                    if (/[0-9]/.test(password)) strength++;
                    if (/[^A-Za-z0-9]/.test(password)) strength++;
                    
                    return Math.min(strength, 4);
                },
                passwordStrengthText() {
                    const texts = ['很弱', '弱', '一般', '强', '很强'];
                    return texts[this.passwordStrength];
                },
                filteredMessages() {
                    let filtered = [...this.messages];
                    
                    // 应用筛选
                    if (this.currentFilter === 'unread') {
                        filtered = filtered.filter(msg => !msg.isRead);
                    } else if (this.currentFilter === 'starred') {
                        filtered = filtered.filter(msg => msg.isStarred);
                    }
                    
                    // 应用搜索
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(msg => 
                            (msg.subject && msg.subject.toLowerCase().includes(query)) ||
                            (msg.from.name && msg.from.name.toLowerCase().includes(query)) ||
                            (msg.from.address && msg.from.address.toLowerCase().includes(query)) ||
                            (msg.text && msg.text.some(t => t.toLowerCase().includes(query))) ||
                            (msg.html && msg.html.some(h => h.toLowerCase().includes(query)))
                        );
                    }
                    
                    // 应用排序
                    filtered.sort((a, b) => {
                        if (this.settings.sortOrder === 'desc') {
                            return new Date(b.createdAt) - new Date(a.createdAt);
                        } else {
                            return new Date(a.createdAt) - new Date(b.createdAt);
                        }
                    });
                    
                    return filtered;
                },
                paginatedMessages() {
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    const end = start + this.itemsPerPage;
                    return this.filteredMessages.slice(start, end);
                },
                localStorageSize() {
                    let total = 0;
                    const settings = JSON.stringify(this.settings).length;
                    const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]').length;
                    const starredMessages = JSON.parse(localStorage.getItem('tempMail_starredMessages') || '[]').length;
                    const accountInfo = JSON.stringify(this.accountInfo).length;
                    
                    return {
                        settings: (settings / 1024).toFixed(2),
                        emailStatus: ((readMessages + starredMessages) * 50 / 1024).toFixed(2), // 估算每个ID约50字节
                        accountInfo: (accountInfo / 1024).toFixed(2)
                    };
                }
            },
            watch: {
                'settings.autoRefresh'(val) {
                    if (val && this.currentEmail) {
                        this.startAutoRefresh();
                    } else {
                        this.stopAutoRefresh();
                    }
                },
                'settings.refreshInterval'() {
                    if (this.settings.autoRefresh && this.currentEmail) {
                        this.stopAutoRefresh();
                        this.startAutoRefresh();
                    }
                },
                'settings.defaultViewMode'(val) {
                    this.viewMode = val;
                },
                currentEmail() {
                    this.selectedEmails = [];
                    this.currentPage = 1;
                    if (this.currentEmail) {
                        this.loadAccountInfo();
                    }
                },
                currentFilter() {
                    this.currentPage = 1;
                    this.selectedEmails = [];
                }
            },
            created() {
                // 加载设置
                this.loadSettings();
                // 尝试从本地存储恢复会话
                this.restoreSession();
                // 获取可用域名
                this.loadDomains();
                // 设置默认视图模式
                this.viewMode = this.settings.defaultViewMode;
            },
            methods: {
                // 显示消息提示
                showMessage(text, color = 'success') {
                    this.snackbar.text = text;
                    this.snackbar.color = color;
                    this.snackbar.show = true;
                },
                
                // 加载设置
                loadSettings() {
                    const savedSettings = localStorage.getItem('tempMail_settings');
                    if (savedSettings) {
                        this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
                    }
                    // 应用主题颜色
                    this.applyTheme();
                },
                
                // 保存设置
                saveSettings() {
                    localStorage.setItem('tempMail_settings', JSON.stringify(this.settings));
                    this.applyTheme();
                    this.showMessage('设置已保存');
                    
                    // 应用设置
                    if (this.settings.autoRefresh && this.currentEmail) {
                        this.startAutoRefresh();
                    }
                },
                
                // 应用主题
                applyTheme() {
                    document.documentElement.style.setProperty('--v-primary-base', this.getColorValue(this.settings.primaryColor));
                    this.$vuetify.theme.dark = this.settings.darkMode;
                },
                
                // 获取颜色值
                getColorValue(colorName) {
                    const colors = {
                        'primary': '#1976D2',
                        'green': '#4CAF50',
                        'red': '#F44336',
                        'orange': '#FF9800',
                        'purple': '#9C27B0',
                        'teal': '#009688',
                        'pink': '#FB7299'
                    };
                    return colors[colorName] || colors.primary;
                }, // 颜色
                
                // 生成随机用户名
                generateUsername() {
                    const adjectives = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
                    const nouns = ['chatgpt', 'claude', 'gemini', 'copilot', 'midjourney', 'dalle', 'perplexity', 'llama', 'deepseek', 'qwen', 'grok', 'mistral', 'stablediffusion', 'firefly', 'ernie', 'tongyiqianwen', 'spark', 'hunyuan', 'glm4', 'phi3', 'sora', 'veo', 'whisper', 'tts1', 'ideogram', 'runway', 'pika', 'luma', 'kling', 'vidu'];
                    const adjective = adjectives[Math.floor(Math.random() * adjectives.length)];
                    const noun = nouns[Math.floor(Math.random() * nouns.length)];
                    const number = Math.floor(Math.random() * 1000); // 从0到1000随机
                    this.newEmail.username = `${adjective}_${noun}${number}`;
                },
                
                // 生成随机密码
                generatePassword() {
                    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                    let password = '';
                    for (let i = 0; i < 12; i++) {
                        password += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    this.newEmail.password = password;
                    this.showPassword = true;
                },
                
                // 从本地存储恢复会话
                restoreSession() {
                    const savedEmail = localStorage.getItem('tempMail_email');
                    const savedToken = localStorage.getItem('tempMail_token');
                    if (savedEmail && savedToken) {
                        this.currentEmail = savedEmail;
                        this.currentToken = savedToken;
                        this.loadMessages();
                        this.loadAccountInfo();
                    }
                },
                
                // 加载账户信息
                loadAccountInfo() {
                    const accountInfoStr = localStorage.getItem(`tempMail_account_${this.currentEmail}`);
                    if (accountInfoStr) {
                        this.accountInfo = JSON.parse(accountInfoStr);
                    } else {
                        // 创建新的账户信息
                        this.accountInfo = {
                            createdAt: new Date().toISOString(),
                            usageTime: '0分钟'
                        };
                        localStorage.setItem(`tempMail_account_${this.currentEmail}`, JSON.stringify(this.accountInfo));
                    }
                    // 更新使用时长
                    this.updateUsageTime();
                },
                
                                // 更新使用时长
                updateUsageTime() {
                    if (!this.accountInfo.createdAt) return;
                    
                    const created = new Date(this.accountInfo.createdAt);
                    const now = new Date();
                    const diffMs = now - created;
                    const diffMins = Math.floor(diffMs / (1000 * 60));
                    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    
                    if (diffDays > 0) {
                        this.accountInfo.usageTime = `${diffDays}天${diffHours % 24}小时`;
                    } else if (diffHours > 0) {
                        this.accountInfo.usageTime = `${diffHours}小时${diffMins % 60}分钟`;
                    } else {
                        this.accountInfo.usageTime = `${diffMins}分钟`;
                    }
                    
                    // 保存更新后的账户信息
                    localStorage.setItem(`tempMail_account_${this.currentEmail}`, JSON.stringify(this.accountInfo));
                },
                
                // 显示用户信息
                showUserProfile() {
                    this.userProfileDialog = true;
                    this.updateUsageTime();
                },
                
                // 获取可用域名
                async loadDomains() {
                    this.loadingDomains = true;
                    try {
                        const response = await fetch('https://api.mail.tm/domains');
                        const data = await response.json();
                        if (data && data['hydra:member']) {
                            this.availableDomains = data['hydra:member'].map(domain => domain.domain);
                            if (this.availableDomains.length > 0) {
                                this.newEmail.domain = this.availableDomains[0];
                            }
                        }
                    } catch (error) {
                        console.error('获取域名失败:', error);
                        this.showMessage('获取域名失败', 'error');
                        // 使用备用域名
                        this.availableDomains = ['mail.tm', 'example.com'];
                        this.newEmail.domain = this.availableDomains[0];
                    } finally {
                        this.loadingDomains = false;
                    }
                },
                
                // 创建邮箱账户
                async createEmailAccount() {
                    if (!this.newEmail.password) {
                        this.showMessage('请输入密码', 'error');
                        return;
                    }
                    
                    if (!this.newEmail.domain) {
                        this.showMessage('请选择域名', 'error');
                        return;
                    }
                    
                    this.creatingAccount = true;
                    
                    try {
                        // 生成随机用户名（如果用户未提供）
                        const username = this.newEmail.username || 
                            Math.random().toString(36).substring(2, 10);
                        
                        const emailAddress = `${username}@${this.newEmail.domain}`;
                        
                        // 创建账户
                        const accountResponse = await fetch('https://api.mail.tm/accounts', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                address: emailAddress,
                                password: this.newEmail.password
                            })
                        });
                        
                        if (!accountResponse.ok) {
                            const errorData = await accountResponse.json().catch(() => ({}));
                            throw new Error(errorData.message || '创建账户失败');
                        }
                        
                        // 获取token
                        const tokenResponse = await fetch('https://api.mail.tm/token', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                address: emailAddress,
                                password: this.newEmail.password
                            })
                        });
                        
                        const tokenData = await tokenResponse.json();
                        
                        if (!tokenData.token) {
                            throw new Error('获取token失败');
                        }
                        
                        // 设置当前邮箱和token
                        this.currentEmail = emailAddress;
                        this.currentToken = tokenData.token;
                        
                        // 保存到本地存储
                        localStorage.setItem('tempMail_email', emailAddress);
                        localStorage.setItem('tempMail_token', tokenData.token);
                        
                        // 初始化账户信息
                        this.accountInfo = {
                            createdAt: new Date().toISOString(),
                            usageTime: '0分钟'
                        };
                        localStorage.setItem(`tempMail_account_${emailAddress}`, JSON.stringify(this.accountInfo));
                        
                        // 加载邮件
                        await this.loadMessages();
                        
                        // 开始自动刷新
                        if (this.settings.autoRefresh) {
                            this.startAutoRefresh();
                        }
                        
                        this.showMessage(`邮箱 ${emailAddress} 创建成功！`, 'success');
                        
                        // 重置表单
                        this.newEmail = {
                            username: '',
                            domain: this.newEmail.domain,
                            password: ''
                        };
                        this.createStep = 1;
                        this.showPassword = false;
                        
                    } catch (error) {
                        console.error('创建邮箱失败:', error);
                        this.showMessage('创建邮箱失败: ' + error.message, 'error');
                    } finally {
                        this.creatingAccount = false;
                    }
                },
                
                // 加载邮件列表
                async loadMessages() {
                    if (!this.currentToken) return;
                    
                    this.loadingMessages = true;
                    try {
                        const response = await fetch('https://api.mail.tm/messages', {
                            headers: {
                                'Authorization': `Bearer ${this.currentToken}`
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error('获取邮件列表失败');
                        }
                        
                        const data = await response.json();
                        if (data && data['hydra:member']) {
                            // 标记已读状态和星标状态（从本地存储读取）
                            const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
                            const starredMessages = JSON.parse(localStorage.getItem('tempMail_starredMessages') || '[]');
                            
                            this.messages = data['hydra:member'].map(msg => ({
                                ...msg,
                                isRead: readMessages.includes(msg.id),
                                isStarred: starredMessages.includes(msg.id)
                            }));
                        }
                    } catch (error) {
                        console.error('加载邮件失败:', error);
                        this.showMessage('加载邮件失败', 'error');
                    } finally {
                        this.loadingMessages = false;
                    }
                },
                
                // 查看邮件详情
                async viewEmail(email) {
                    try {
                        const response = await fetch(`https://api.mail.tm/messages/${email.id}`, {
                            headers: {
                                'Authorization': `Bearer ${this.currentToken}`
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error('获取邮件详情失败');
                        }
                        
                        const emailDetail = await response.json();
                        this.currentEmailDetail = {
                            ...emailDetail,
                            isRead: email.isRead,
                            isStarred: email.isStarred
                        };
                        this.emailDetailDialog = true;
                        
                        // 标记为已读
                        if (this.settings.markAsReadOnOpen && !email.isRead) {
                            this.markAsRead(email.id);
                        }
                    } catch (error) {
                        console.error('加载邮件详情失败:', error);
                        this.showMessage('加载邮件详情失败', 'error');
                    }
                },
                
                // 标记邮件为已读
                markAsRead(messageId) {
                    const index = this.messages.findIndex(msg => msg.id === messageId);
                    if (index !== -1) {
                        this.messages[index].isRead = true;
                        
                        // 保存到本地存储
                        const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
                        if (!readMessages.includes(messageId)) {
                            readMessages.push(messageId);
                            localStorage.setItem('tempMail_readMessages', JSON.stringify(readMessages));
                        }
                    }
                },
                
                // 标记邮件为未读
//                markAsUnread(messageId) {
//                    const index = this.messages.findIndex(msg => msg.id === messageId);
//                    if (index !== -1) {
//                        this.messages[index].isRead = false;
                        
                        // 从本地存储移除
//                        const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
//                        const updatedReadMessages = readMessages.filter(id => id !== messageId);
//                        localStorage.setItem('tempMail_readMessages', JSON.stringify(updatedReadMessages));
//                    }
//                },
                
                // 标记选中邮件为未读（新增方法）
//                markSelectedAsUnread() {
//                    if (this.selectedEmails.length === 0) {
//                        this.showMessage('请先选择邮件', 'warning');
//                        return;
//                    }
                    
//                    const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
//                    let markedCount = 0;
                    
//                    this.selectedEmails.forEach(messageId => {
//                       const index = this.messages.findIndex(msg => msg.id === messageId);
//                        if (index !== -1 && this.messages[index].isRead) {
//                            this.messages[index].isRead = false;
//                            markedCount++;
//                            const messageIndex = readMessages.indexOf(messageId);
//                            if (messageIndex > -1) {
//                                readMessages.splice(messageIndex, 1);
//                            }
//                        }
//                    });
                    
//                    localStorage.setItem('tempMail_readMessages', JSON.stringify(readMessages));
                    
//                    if (markedCount > 0) {
//                        this.showMessage(`已标记 ${markedCount} 封邮件为未读`);
//                    } else {
//                        this.showMessage('选中的邮件都未读', 'info');
//                    }
                    
//                    this.selectedEmails = [];
//                },
                
                
                // 标记邮件为未读 - 修复版本
markAsUnread(messageId) {
    const index = this.messages.findIndex(msg => msg.id === messageId);
    if (index !== -1) {
        // 更新状态
        this.messages[index].isRead = false;
        
        // 更新本地存储
        const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
        const updatedReadMessages = readMessages.filter(id => id !== messageId);
        localStorage.setItem('tempMail_readMessages', JSON.stringify(updatedReadMessages));
        
        // 如果当前正在查看邮件详情，更新详情视图
        if (this.currentEmailDetail && this.currentEmailDetail.id === messageId) {
            this.currentEmailDetail.isRead = false;
        }
        
        // 触发视图更新 - 强制重新计算未读计数相关属性
        this.$forceUpdate();
        
        // 显示成功提示
        this.showMessage('邮件已标记为未读', 'info');
    }
},

// 标记选中邮件为未读 - 修复版本
markSelectedAsUnread() {
    if (this.selectedEmails.length === 0) {
        this.showMessage('请先选择邮件', 'warning');
        return;
    }
    
    // 获取当前已读列表
    const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
    let markedCount = 0;
    
    // 遍历选中的邮件
    this.selectedEmails.forEach(messageId => {
        const index = this.messages.findIndex(msg => msg.id === messageId);
        if (index !== -1 && this.messages[index].isRead) {
            // 更新状态为未读
            this.messages[index].isRead = false;
            markedCount++;
            
            // 从已读列表中移除
            const messageIndex = readMessages.indexOf(messageId);
            if (messageIndex > -1) {
                readMessages.splice(messageIndex, 1);
            }
            
            // 如果当前正在查看的邮件被标记为未读，更新详情视图
            if (this.currentEmailDetail && this.currentEmailDetail.id === messageId) {
                this.currentEmailDetail.isRead = false;
            }
        }
    });
    
    // 保存更新后的已读列表
    localStorage.setItem('tempMail_readMessages', JSON.stringify(readMessages));
    
    // 触发视图更新
    this.$forceUpdate();
    
    if (markedCount > 0) {
        this.showMessage(`已标记 ${markedCount} 封邮件为未读`, 'success');
    } else {
        this.showMessage('选中的邮件都未读', 'info');
    }
    
    // 清空选中状态
    this.selectedEmails = [];
},

// 刷新未读状态显示
refreshUnreadStatus() {
    // 从本地存储重新加载已读状态
    const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
    
    // 更新所有邮件的已读状态
    this.messages = this.messages.map(msg => ({
        ...msg,
        isRead: readMessages.includes(msg.id)
    }));
    
    // 触发视图更新
    this.$forceUpdate();
},

                // 切换星标状态
                toggleStar(messageId) {
                    const index = this.messages.findIndex(msg => msg.id === messageId);
                    if (index !== -1) {
                        this.messages[index].isStarred = !this.messages[index].isStarred;
                        
                        // 更新本地存储
                        const starredMessages = JSON.parse(localStorage.getItem('tempMail_starredMessages') || '[]');
                        if (this.messages[index].isStarred) {
                            if (!starredMessages.includes(messageId)) {
                                starredMessages.push(messageId);
                            }
                        } else {
                            const messageIndex = starredMessages.indexOf(messageId);
                            if (messageIndex > -1) {
                                starredMessages.splice(messageIndex, 1);
                            }
                        }
                        localStorage.setItem('tempMail_starredMessages', JSON.stringify(starredMessages));
                        
                        if (this.currentEmailDetail && this.currentEmailDetail.id === messageId) {
                            this.currentEmailDetail.isStarred = this.messages[index].isStarred;
                        }
                    }
                },
                
                // 删除邮件
                async deleteEmail(messageId) {
                    if (!confirm('确定要删除这封邮件吗？')) return;
                    
                    try {
                        const response = await fetch(`https://api.mail.tm/messages/${messageId}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${this.currentToken}`
                            }
                        });
                        
                        if (response.ok) {
                            // 从列表中移除
                            this.messages = this.messages.filter(msg => msg.id !== messageId);
                            
                            // 从选中列表中移除
                            this.selectedEmails = this.selectedEmails.filter(id => id !== messageId);
                            
                            // 更新本地存储
                            const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
                            const updatedReadMessages = readMessages.filter(id => id !== messageId);
                            localStorage.setItem('tempMail_readMessages', JSON.stringify(updatedReadMessages));
                            
                            const starredMessages = JSON.parse(localStorage.getItem('tempMail_starredMessages') || '[]');
                            const updatedStarredMessages = starredMessages.filter(id => id !== messageId);
                            localStorage.setItem('tempMail_starredMessages', JSON.stringify(updatedStarredMessages));
                            
                            this.showMessage('邮件删除成功');
                        } else {
                            throw new Error('删除失败');
                        }
                    } catch (error) {
                        console.error('删除邮件失败:', error);
                        this.showMessage('删除邮件失败', 'error');
                    }
                },
                
                // 删除选中的邮件
                async deleteSelectedEmails() {
                    if (this.selectedEmails.length === 0) return;
                    
                    if (!confirm(`确定要删除选中的 ${this.selectedEmails.length} 封邮件吗？`)) return;
                    
                    const deletePromises = this.selectedEmails.map(id => 
                        fetch(`https://api.mail.tm/messages/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${this.currentToken}`
                            }
                        })
                    );
                    
                    try {
                        await Promise.all(deletePromises);
                        
                        // 从列表中移除
                        this.messages = this.messages.filter(msg => !this.selectedEmails.includes(msg.id));
                        
                        // 清空选中列表
                        this.selectedEmails = [];
                        
                        // 更新本地存储
                        const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
                        const starredMessages = JSON.parse(localStorage.getItem('tempMail_starredMessages') || '[]');
                        
                        const updatedReadMessages = readMessages.filter(id => !this.selectedEmails.includes(id));
                        const updatedStarredMessages = starredMessages.filter(id => !this.selectedEmails.includes(id));
                        
                        localStorage.setItem('tempMail_readMessages', JSON.stringify(updatedReadMessages));
                        localStorage.setItem('tempMail_starredMessages', JSON.stringify(updatedStarredMessages));
                        
                        this.showMessage(`成功删除 ${deletePromises.length} 封邮件`);
                    } catch (error) {
                        console.error('批量删除邮件失败:', error);
                        this.showMessage('批量删除邮件失败', 'error');
                    }
                },
                
                // 标记选中邮件为已读
                markSelectedAsRead() {
                    if (this.selectedEmails.length === 0) {
                        this.showMessage('请先选择邮件', 'warning');
                        return;
                    }
                    
                    const readMessages = JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]');
                    let markedCount = 0;
                    
                    this.selectedEmails.forEach(messageId => {
                        const index = this.messages.findIndex(msg => msg.id === messageId);
                        if (index !== -1 && !this.messages[index].isRead) {
                            this.messages[index].isRead = true;
                            markedCount++;
                            if (!readMessages.includes(messageId)) {
                                readMessages.push(messageId);
                            }
                        }
                    });
                    
                    localStorage.setItem('tempMail_readMessages', JSON.stringify(readMessages));
                    
                    if (markedCount > 0) {
                        this.showMessage(`已标记 ${markedCount} 封邮件为已读`);
                    } else {
                        this.showMessage('选中的邮件都已读', 'info');
                    }
                    
                    this.selectedEmails = [];
                },
                
                // 切换选中邮件的星标状态
                toggleStarSelected() {
                    if (this.selectedEmails.length === 0) {
                        this.showMessage('请先选择邮件', 'warning');
                        return;
                    }
                    
                    const starredMessages = JSON.parse(localStorage.getItem('tempMail_starredMessages') || '[]');
                    const willStar = !this.allSelectedStarred;
                    let updatedCount = 0;
                    
                    this.selectedEmails.forEach(messageId => {
                        const index = this.messages.findIndex(msg => msg.id === messageId);
                        if (index !== -1) {
                            const wasStarred = this.messages[index].isStarred;
                            this.messages[index].isStarred = willStar;
                            
                            if (willStar && !wasStarred) {
                                updatedCount++;
                                if (!starredMessages.includes(messageId)) {
                                    starredMessages.push(messageId);
                                }
                            } else if (!willStar && wasStarred) {
                                updatedCount++;
                                const messageIndex = starredMessages.indexOf(messageId);
                                if (messageIndex > -1) {
                                    starredMessages.splice(messageIndex, 1);
                                }
                            }
                        }
                    });
                    
                    localStorage.setItem('tempMail_starredMessages', JSON.stringify(starredMessages));
                    
                    if (updatedCount > 0) {
                        this.showMessage(`${willStar ? '添加' : '移除'}星标成功（${updatedCount} 封邮件）`);
                    }
                    
                    this.selectedEmails = [];
                },
                
                // 清空所有邮件
                async clearAllEmails() {
                    if (this.messages.length === 0) return;
                    
                    if (!confirm(`确定要清空所有 ${this.messages.length} 封邮件吗？此操作不可撤销！`)) return;
                    
                    try {
                        const deletePromises = this.messages.map(msg => 
                            fetch(`https://api.mail.tm/messages/${msg.id}`, {
                                method: 'DELETE',
                                headers: {
                                    'Authorization': `Bearer ${this.currentToken}`
                                }
                            })
                        );
                        
                        await Promise.all(deletePromises);
                        
                        this.messages = [];
                        this.selectedEmails = [];
                        
                        // 清空本地存储中的邮件状态
                        localStorage.removeItem('tempMail_readMessages');
                        localStorage.removeItem('tempMail_starredMessages');
                        
                        this.showMessage('已清空所有邮件');
                    } catch (error) {
                        console.error('清空邮件失败:', error);
                        this.showMessage('清空邮件失败', 'error');
                    }
                },
                
                // 刷新邮箱
                refreshMail() {
                    if (this.currentEmail) {
                        this.loadMessages();
                        this.showMessage('邮箱已刷新');
                    }
                },
                
                // 开始自动刷新
                startAutoRefresh() {
                    this.stopAutoRefresh();
                    this.refreshTimer = setInterval(() => {
                        if (this.currentEmail) {
                            this.loadMessages();
                        }
                    }, this.settings.refreshInterval * 1000);
                },
                
                // 停止自动刷新
                stopAutoRefresh() {
                    if (this.refreshTimer) {
                        clearInterval(this.refreshTimer);
                        this.refreshTimer = null;
                    }
                },
                
                // 创建新邮箱
                createNewEmail() {
                    this.drawer = false;
                    // 清除当前会话
                    this.currentEmail = null;
                    this.currentToken = null;
                    this.messages = [];
                    this.selectedEmails = [];
                    localStorage.removeItem('tempMail_email');
                    localStorage.removeItem('tempMail_token');
                    this.stopAutoRefresh();
                    this.showMessage('已退出当前邮箱，请创建新邮箱');
                },
                
                // 复制邮箱地址到剪贴板
                copyEmailToClipboard() {
                    if (!this.currentEmail) return;
                    
                    navigator.clipboard.writeText(this.currentEmail)
                        .then(() => {
                            this.showMessage('邮箱地址已复制到剪贴板');
                        })
                        .catch(err => {
                            console.error('复制失败:', err);
                            // 备用复制方法
                            const textArea = document.createElement('textarea');
                            textArea.value = this.currentEmail;
                            document.body.appendChild(textArea);
                            textArea.select();
                            try {
                                document.execCommand('copy');
                                this.showMessage('邮箱地址已复制到剪贴板');
                            } catch (e) {
                                this.showMessage('复制失败，请手动复制', 'error');
                            }
                            document.body.removeChild(textArea);
                        });
                },
                
                // 导出邮件数据 - 增强版，真正导出
                async exportEmails(exportAll = false, singleEmail = null) {
                    let emailsToExport = [];
                    
                    if (singleEmail) {
                        // 导出单封邮件
                        emailsToExport = [singleEmail];
                    } else if (exportAll) {
                        // 导出所有邮件
                        if (this.messages.length === 0) {
                            this.showMessage('没有邮件可导出', 'warning');
                            return;
                        }
                        emailsToExport = this.messages;
                    } else {
                        // 导出选中的邮件
                        if (this.selectedEmails.length === 0) {
                            this.showMessage('请先选择要导出的邮件', 'warning');
                            return;
                        }
                        emailsToExport = this.messages.filter(msg => this.selectedEmails.includes(msg.id));
                    }
                    
                    try {
                        // 获取完整的邮件详情
                        const detailedEmails = [];
                        for (const email of emailsToExport) {
                            try {
                                const response = await fetch(`https://api.mail.tm/messages/${email.id}`, {
                                    headers: {
                                        'Authorization': `Bearer ${this.currentToken}`
                                    }
                                });
                                if (response.ok) {
                                    const detailedEmail = await response.json();
                                    detailedEmails.push({
                                        ...detailedEmail,
                                        isRead: email.isRead,
                                        isStarred: email.isStarred
                                    });
                                }
                            } catch (error) {
                                console.warn(`获取邮件 ${email.id} 详情失败:`, error);
                                // 使用基础信息
                                detailedEmails.push(email);
                            }
                        }
                        
                        const exportData = {
                            exportInfo: {
                                exportTime: new Date().toISOString(),
                                emailAddress: this.currentEmail,
                                exportType: exportAll ? 'all' : (singleEmail ? 'single' : 'selected'),
                                totalCount: detailedEmails.length
                            },
                            emails: detailedEmails.map(email => ({
                                id: email.id,
                                messageId: email.id,
                                from: email.from,
                                to: email.to,
                                subject: email.subject,
                                intro: email.intro,
                                text: email.text,
                                html: email.html,
                                createdAt: email.createdAt,
                                updatedAt: email.updatedAt,
                                isRead: email.isRead,
                                isStarred: email.isStarred,
                                attachments: email.attachments || []
                            }))
                        };
                        
                        const dataStr = JSON.stringify(exportData, null, 2);
                        const dataBlob = new Blob([dataStr], { type: 'application/json' });
                        const url = URL.createObjectURL(dataBlob);
                        
                        const timestamp = new Date().toISOString().slice(0, 19).replace(/[:]/g, '-');
                        const filename = singleEmail ? 
                            `email-${singleEmail.id}-${timestamp}.json` :
                            exportAll ? 
                                `temp-mail-all-emails-${timestamp}.json` :
                                `temp-mail-selected-emails-${timestamp}.json`;
                        
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = filename;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                        
                        this.showMessage(`成功导出 ${detailedEmails.length} 封邮件`);
                        
                        if (!exportAll && !singleEmail) {
                            this.selectedEmails = [];
                        }
                        
                    } catch (error) {
                        console.error('导出邮件失败:', error);
                        this.showMessage('导出邮件失败', 'error');
                    }
                },
                
                // 导出所有数据
                exportAllData() {
                    const exportData = {
                        exportInfo: {
                            exportTime: new Date().toISOString(),
                            version: '2.1.0',
                            dataType: 'full-backup'
                        },
                        settings: this.settings,
                        accountInfo: this.accountInfo,
                        currentEmail: this.currentEmail,
                        readMessages: JSON.parse(localStorage.getItem('tempMail_readMessages') || '[]'),
                        starredMessages: JSON.parse(localStorage.getItem('tempMail_starredMessages') || '[]'),
                        emailStats: {
                            totalMessages: this.messages.length,
                            unreadCount: this.unreadCount,
                            starredCount: this.starredCount,
                            filteredMessages: this.filteredMessages.length
                        }
                    };
                    
                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/[:]/g, '-');
                    const filename = `temp-mail-full-backup-${timestamp}.json`;
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showMessage('所有数据已导出');
                },
                
                // 清除所有本地数据
                clearAllData() {
                    if (confirm('确定要清除所有本地数据吗？包括设置、邮件状态、账户信息等。此操作不可撤销！')) {
                        localStorage.clear();
                        this.currentEmail = null;
                        this.currentToken = null;
                        this.messages = [];
                        this.selectedEmails = [];
                        this.accountInfo = {
                            createdAt: null,
                            usageTime: '0分钟'
                        };
                        this.stopAutoRefresh();
                        this.loadSettings(); // 重新加载默认设置
                        this.showMessage('所有本地数据已清除', 'warning');
                    }
                },
                
                // 显示收件箱
                showInbox() {
                    this.drawer = false;
                    if (this.currentEmail) {
                        this.loadMessages();
                    }
                },
                
                // 设置筛选器
                setFilter(filter) {
                    this.currentFilter = filter;
                    this.currentPage = 1;
                    this.selectedEmails = [];
                },
                
                // 切换视图模式
                toggleViewMode() {
                    this.viewMode = this.viewMode === 'list' ? 'grid' : 'list';
                    this.settings.defaultViewMode = this.viewMode;
                    this.saveSettings();
                },
                
                // 格式化日期
                formatDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit'
                    });
                },
                
                // 格式化相对时间
                formatRelativeTime(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / (1000 * 60));
                    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    
                    if (diffMins < 1) {
                        return '刚刚';
                    } else if (diffMins < 60) {
                        return `${diffMins}分钟前`;
                    } else if (diffHours < 24) {
                        return `${diffHours}小时前`;
                    } else if (diffDays === 1) {
                        return '昨天';
                    } else if (diffDays < 7) {
                        return `${diffDays}天前`;
                    } else {
                        return this.formatDate(dateString);
                    }
                },
                
                // 格式化邮件内容
                formatEmailContent(email) {
                    if (email.html && email.html.length > 0) {
                        // 如果HTML内容包含完整的HTML文档，提取body内容
                        const bodyMatch = email.html[0].match(/<body[^>]*>([\s\S]*)<\/body>/i);
                        if (bodyMatch) {
                            return bodyMatch[1];
                        }
                        return email.html[0];
                    } else if (email.text && email.text.length > 0) {
                        // 纯文本内容，保留换行
                        return email.text[0].replace(/\n/g, '<br>');
                    }
                    return '<p style="color: #999; font-style: italic;">(无内容)</p>';
                },
                
                // 获取邮件预览
                getEmailPreview(email) {
                    if (email.text && email.text.length > 0) {
                        const text = email.text[0];
                        return text.length > 100 ? text.substring(0, 100) + '...' : text;
                    } else if (email.html && email.html.length > 0) {
                        // 从HTML中提取纯文本预览
                        const html = email.html[0];
                        const text = html.replace(/<[^>]*>/g, '');
                        return text.length > 100 ? text.substring(0, 100) + '...' : text;
                    }
                    return '(无内容)';
                },
                
                // 获取发件人首字母
                getSenderInitial(sender) {
                    if (!sender) return '?';
                    // 提取邮箱地址中的用户名部分的首字母
                    const emailMatch = sender.match(/([a-zA-Z0-9._%+-]+)@/);
                    if (emailMatch && emailMatch[1]) {
                        return emailMatch[1].charAt(0).toUpperCase();
                    }
                    // 或者使用整个字符串的首字母
                    return sender.charAt(0).toUpperCase();
                },
                
                // 截断邮箱地址显示
                truncateEmail(email) {
                    if (!email) return '';
                    if (email.length <= 20) return email;
                    const username = email.split('@')[0];
                    const domain = email.split('@')[1];
                    if (username.length > 10) {
                        return username.substring(0, 10) + '...@' + domain;
                    }
                    return email;
                },
                
                // 检查邮件是否有附件
                hasAttachments(email) {
                    return email.attachments && email.attachments.length > 0;
                },
                
                // 获取附件数量
                getAttachmentCount(email) {
                    return email.attachments ? email.attachments.length : 0;
                },
                
                // 获取附件列表
                getAttachments(email) {
                    return email.attachments || [];
                },
                
                // 格式化文件大小
                formatFileSize(bytes) {
                    if (!bytes) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },
                
                // 下载附件（模拟功能）
                downloadAttachment(attachment) {
                    // 注意：Mail.tm API 可能不支持直接下载附件
                    // 这里只是一个模拟功能
                    this.showMessage('附件下载功能暂不可用（API限制）', 'info');
                }
            },
            beforeDestroy() {
                this.stopAutoRefresh();
            }
        });
    </script>
    
    <style>
    /* ==================== 颜色预览小方块 ==================== */
    .color-preview {
        width: 24px;                /* 宽度24像素，小方块 */
        height: 24px;               /* 高度24像素，与宽度相同形成正方形 */
        border-radius: 4px;         /* 4像素圆角，让方块边缘稍微圆润 */
        border: 1px solid #ddd;     /* 浅灰色边框，厚度1像素，实线，让方块边界清晰 */
        /* 这个类常用于显示颜色选择器中的颜色样本，或者标记某个颜色 */
    }

    /* ==================== 小型发件人头像 ==================== */
    .sender-avatar-small {
        width: 32px;                /* 宽度32像素 */
        height: 32px;               /* 高度32像素，保持正方形 */
        border-radius: 50%;         /* 圆形裁剪（50%圆角），变成正圆形头像 */
        background: var(--v-primary-base); /* 背景色使用CSS变量 --v-primary-base，通常是主题主色（由外部定义） */
        color: white;               /* 文字颜色白色，与背景形成对比 */
        display: flex;              /* 使用弹性盒布局，方便内部文字居中 */
        align-items: center;        /* 垂直居中 */
        justify-content: center;    /* 水平居中 */
        font-weight: bold;          /* 文字加粗，比如显示名字缩写或图标 */
        font-size: 14px;            /* 字体大小14像素，适合小头像内的文字 */
        /* 这个类比之前的 .sender-avatar 更小（32px vs 40px），适用于紧凑布局 */
    }
</style>
<!-- 图片无法加载相关 -->
<script>
   class ImageFallbackManager {
    constructor(options = {}) {
        this.options = {
            fallbackUrl: options.fallbackUrl || 'icon.png',
            errorClass: options.errorClass || 'img-error',
            altText: options.altText || '图片加载失败',
            ...options
        };
        
        this.init();
    }
    
    init() {
        // 立即处理现有图片
        this.processExistingImages();
        
        // 监听动态添加的图片
        this.setupMutationObserver();
        
        // 监听页面可见性变化（标签页切换回来时重新检查）
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) this.checkFailedImages();
        });
    }
    
    processExistingImages() {
        document.querySelectorAll('img').forEach(img => {
            this.setupImage(img);
            
            // 检查已经加载失败的图片
            if (img.complete && img.naturalHeight === 0 && img.src !== this.options.fallbackUrl) {
                this.handleError(img);
            }
        });
    }
    
    setupImage(img) {
        // 移除现有监听器避免重复
        img.removeEventListener('error', this.handleError);
        
        // 绑定错误处理
        img.addEventListener('error', () => this.handleError(img));
        
        // 如果有 data-fallback 属性，使用自定义备用图
        if (img.dataset.fallback) {
            img.dataset.originalFallback = img.dataset.fallback;
        }
    }
    
    handleError(img) {
        // 防止无限循环
        if (img.src.includes(this.options.fallbackUrl) || 
            img.dataset.fallbackProcessed) return;
        
        img.dataset.fallbackProcessed = 'true';
        img.dataset.originalSrc = img.src; // 保存原始地址
        
        // 优先使用 data-fallback，其次是全局配置
        const fallbackUrl = img.dataset.fallback || this.options.fallbackUrl;
        
        // 替换图片
        img.src = fallbackUrl;
        img.alt = this.options.altText;
        img.classList.add(this.options.errorClass);
        
        console.warn(`图片加载失败: ${img.dataset.originalSrc}, 已替换为: ${fallbackUrl}`);
    }
    
    setupMutationObserver() {
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.nodeType === 1) {
                        // 如果是 img 元素
                        if (node.tagName === 'IMG') {
                            this.setupImage(node);
                        }
                        // 查找子元素中的 img
                        if (node.querySelectorAll) {
                            node.querySelectorAll('img').forEach(img => this.setupImage(img));
                        }
                    }
                });
            });
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        this.observer = observer;
    }
    
    checkFailedImages() {
        document.querySelectorAll('img').forEach(img => {
            if (img.complete && img.naturalHeight === 0 && 
                !img.src.includes(this.options.fallbackUrl) &&
                !img.dataset.fallbackProcessed) {
                this.handleError(img);
            }
        });
    }
    
    disconnect() {
        if (this.observer) {
            this.observer.disconnect();
        }
    }
}

// 使用示例
window.addEventListener('DOMContentLoaded', () => {
    window.imageFallback = new ImageFallbackManager({
        fallbackUrl: 'icon.png',
        errorClass: 'failed-img',
        altText: '图片无法加载'
    });
});

</script>
</body>
</html>
